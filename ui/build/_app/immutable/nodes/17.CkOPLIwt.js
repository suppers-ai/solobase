import{S as Ne,i as Ae,s as ze,n as le,d as _,a as te,a1 as ve,b as M,c as o,E as U,C as i,e as d,f as N,g as Q,h as A,F as $,j as h,t as W,k as z,a0 as $e,B as He,K as Y,M as Qe,U as st,V as at,G as Ee,a6 as tl,I as qe,o as ae,p as x,J as je,D as Me,w as Ve,x as Pe,y as Re,z as Se,L as lt,N as ct,O as ut,H as el}from"../chunks/BDqP8p-g.js";import"../chunks/IHki7fMi.js";import{e as be}from"../chunks/D6YF6ztN.js";function dt(s){let e,t="System";return{c(){e=h("span"),e.textContent=t,this.h()},l(l){e=d(l,"SPAN",{class:!0,"data-svelte-h":!0}),$(e)!=="svelte-xvbepf"&&(e.textContent=t),this.h()},h(){i(e,"class","badge svelte-11yu3xl")},m(l,a){M(l,e,a)},d(l){l&&_(e)}}}function ht(s){let e,t,l="Disabled Features",a,n,r,u=s[0].metadata.disabled_features.join(", ")+"",c;return{c(){e=h("div"),t=h("h4"),t.textContent=l,a=z(),n=h("ul"),r=h("li"),c=W(u),this.h()},l(v){e=d(v,"DIV",{class:!0});var f=N(e);t=d(f,"H4",{class:!0,"data-svelte-h":!0}),$(t)!=="svelte-tpgvej"&&(t.textContent=l),a=A(f),n=d(f,"UL",{class:!0});var m=N(n);r=d(m,"LI",{class:!0});var g=N(r);c=Q(g,u),g.forEach(_),m.forEach(_),f.forEach(_),this.h()},h(){i(t,"class","svelte-11yu3xl"),i(r,"class","svelte-11yu3xl"),i(n,"class","svelte-11yu3xl"),i(e,"class","role-metadata svelte-11yu3xl")},m(v,f){M(v,e,f),o(e,t),o(e,a),o(e,n),o(n,r),o(r,c)},p(v,f){f&1&&u!==(u=v[0].metadata.disabled_features.join(", ")+"")&&te(c,u)},d(v){v&&_(e)}}}function vt(s){let e,t="Delete",l,a;return{c(){e=h("button"),e.textContent=t,this.h()},l(n){e=d(n,"BUTTON",{class:!0,"data-svelte-h":!0}),$(e)!=="svelte-7wb2nw"&&(e.textContent=t),this.h()},h(){i(e,"class","btn btn-small btn-danger svelte-11yu3xl")},m(n,r){M(n,e,r),l||(a=U(e,"click",s[1]),l=!0)},p:le,d(n){n&&_(e),l=!1,a()}}}function ll(s){var I,V;let e,t,l,a=(s[0].display_name||s[0].name)+"",n,r,u,c,v=s[0].description+"",f,m,g,C,k,E="Edit",p,y,w,b=s[0].is_system&&dt(),T=((V=(I=s[0].metadata)==null?void 0:I.disabled_features)==null?void 0:V.length)>0&&ht(s),D=!s[0].is_system&&vt(s);return{c(){e=h("div"),t=h("div"),l=h("h3"),n=W(a),r=z(),b&&b.c(),u=z(),c=h("p"),f=W(v),m=z(),T&&T.c(),g=z(),C=h("div"),k=h("button"),k.textContent=E,p=z(),D&&D.c(),this.h()},l(L){e=d(L,"DIV",{class:!0});var P=N(e);t=d(P,"DIV",{class:!0});var R=N(t);l=d(R,"H3",{class:!0});var B=N(l);n=Q(B,a),B.forEach(_),r=A(R),b&&b.l(R),R.forEach(_),u=A(P),c=d(P,"P",{class:!0});var O=N(c);f=Q(O,v),O.forEach(_),m=A(P),T&&T.l(P),g=A(P),C=d(P,"DIV",{class:!0});var F=N(C);k=d(F,"BUTTON",{class:!0,"data-svelte-h":!0}),$(k)!=="svelte-werako"&&(k.textContent=E),p=A(F),D&&D.l(F),F.forEach(_),P.forEach(_),this.h()},h(){i(l,"class","svelte-11yu3xl"),i(t,"class","role-header svelte-11yu3xl"),i(c,"class","role-description svelte-11yu3xl"),i(k,"class","btn btn-small svelte-11yu3xl"),i(C,"class","role-actions svelte-11yu3xl"),i(e,"class","role-card svelte-11yu3xl"),ve(e,"system",s[0].is_system)},m(L,P){M(L,e,P),o(e,t),o(t,l),o(l,n),o(t,r),b&&b.m(t,null),o(e,u),o(e,c),o(c,f),o(e,m),T&&T.m(e,null),o(e,g),o(e,C),o(C,k),o(C,p),D&&D.m(C,null),y||(w=U(k,"click",s[2]),y=!0)},p(L,[P]){var R,B;P&1&&a!==(a=(L[0].display_name||L[0].name)+"")&&te(n,a),L[0].is_system?b||(b=dt(),b.c(),b.m(t,null)):b&&(b.d(1),b=null),P&1&&v!==(v=L[0].description+"")&&te(f,v),((B=(R=L[0].metadata)==null?void 0:R.disabled_features)==null?void 0:B.length)>0?T?T.p(L,P):(T=ht(L),T.c(),T.m(e,g)):T&&(T.d(1),T=null),L[0].is_system?D&&(D.d(1),D=null):D?D.p(L,P):(D=vt(L),D.c(),D.m(C,null)),P&1&&ve(e,"system",L[0].is_system)},i:le,o:le,d(L){L&&_(e),b&&b.d(),T&&T.d(),D&&D.d(),y=!1,w()}}}function sl(s,e,t){let{role:l}=e;const a=$e();function n(){a("delete",l)}function r(){a("edit",l)}return s.$$set=u=>{"role"in u&&t(0,l=u.role)},[l,n,r]}class al extends Ne{constructor(e){super(),Ae(this,e,sl,ll,ze,{role:0})}}function nl(s){let e,t,l,a="Create New Role",n,r,u,c="Name (lowercase, no spaces)",v,f,m,g,C,k="Display Name",E,p,y,w,b,T="Description",D,I,V,L,P="Quotas & Limits",R,B,O,F="Storage Quota (bytes)",J,j,H,S,q,ee="Bandwidth Quota (bytes)",ie,G,oe,ne,Z,ge="Max Upload Size (bytes)",se,K,X,ce,ue,de="Max Requests per Minute",_e,he,ye,Ce,ke,Be="Cancel",Te,Le,Ze="Create",Oe,We;return{c(){e=h("div"),t=h("div"),l=h("h2"),l.textContent=a,n=z(),r=h("div"),u=h("label"),u.textContent=c,v=z(),f=h("input"),m=z(),g=h("div"),C=h("label"),C.textContent=k,E=z(),p=h("input"),y=z(),w=h("div"),b=h("label"),b.textContent=T,D=z(),I=h("textarea"),V=z(),L=h("h3"),L.textContent=P,R=z(),B=h("div"),O=h("label"),O.textContent=F,J=z(),j=h("input"),H=z(),S=h("div"),q=h("label"),q.textContent=ee,ie=z(),G=h("input"),oe=z(),ne=h("div"),Z=h("label"),Z.textContent=ge,se=z(),K=h("input"),X=z(),ce=h("div"),ue=h("label"),ue.textContent=de,_e=z(),he=h("input"),ye=z(),Ce=h("div"),ke=h("button"),ke.textContent=Be,Te=z(),Le=h("button"),Le.textContent=Ze,this.h()},l(pe){e=d(pe,"DIV",{class:!0});var me=N(e);t=d(me,"DIV",{class:!0});var re=N(t);l=d(re,"H2",{class:!0,"data-svelte-h":!0}),$(l)!=="svelte-ewbr88"&&(l.textContent=a),n=A(re),r=d(re,"DIV",{class:!0});var Xe=N(r);u=d(Xe,"LABEL",{for:!0,class:!0,"data-svelte-h":!0}),$(u)!=="svelte-bndij3"&&(u.textContent=c),v=A(Xe),f=d(Xe,"INPUT",{id:!0,type:!0,placeholder:!0,class:!0}),Xe.forEach(_),m=A(re),g=d(re,"DIV",{class:!0});var Fe=N(g);C=d(Fe,"LABEL",{for:!0,class:!0,"data-svelte-h":!0}),$(C)!=="svelte-ji2u0g"&&(C.textContent=k),E=A(Fe),p=d(Fe,"INPUT",{id:!0,type:!0,placeholder:!0,class:!0}),Fe.forEach(_),y=A(re),w=d(re,"DIV",{class:!0});var we=N(w);b=d(we,"LABEL",{for:!0,class:!0,"data-svelte-h":!0}),$(b)!=="svelte-1dib82y"&&(b.textContent=T),D=A(we),I=d(we,"TEXTAREA",{id:!0,placeholder:!0,class:!0}),N(I).forEach(_),we.forEach(_),V=A(re),L=d(re,"H3",{class:!0,"data-svelte-h":!0}),$(L)!=="svelte-1mooygl"&&(L.textContent=P),R=A(re),B=d(re,"DIV",{class:!0});var Je=N(B);O=d(Je,"LABEL",{for:!0,class:!0,"data-svelte-h":!0}),$(O)!=="svelte-1he67v5"&&(O.textContent=F),J=A(Je),j=d(Je,"INPUT",{id:!0,type:!0,class:!0}),Je.forEach(_),H=A(re),S=d(re,"DIV",{class:!0});var Ue=N(S);q=d(Ue,"LABEL",{for:!0,class:!0,"data-svelte-h":!0}),$(q)!=="svelte-1a12571"&&(q.textContent=ee),ie=A(Ue),G=d(Ue,"INPUT",{id:!0,type:!0,class:!0}),Ue.forEach(_),oe=A(re),ne=d(re,"DIV",{class:!0});var Ge=N(ne);Z=d(Ge,"LABEL",{for:!0,class:!0,"data-svelte-h":!0}),$(Z)!=="svelte-86wo1v"&&(Z.textContent=ge),se=A(Ge),K=d(Ge,"INPUT",{id:!0,type:!0,class:!0}),Ge.forEach(_),X=A(re),ce=d(re,"DIV",{class:!0});var Ke=N(ce);ue=d(Ke,"LABEL",{for:!0,class:!0,"data-svelte-h":!0}),$(ue)!=="svelte-17i6wft"&&(ue.textContent=de),_e=A(Ke),he=d(Ke,"INPUT",{id:!0,type:!0,class:!0}),Ke.forEach(_),ye=A(re),Ce=d(re,"DIV",{class:!0});var fe=N(Ce);ke=d(fe,"BUTTON",{class:!0,"data-svelte-h":!0}),$(ke)!=="svelte-rrbwep"&&(ke.textContent=Be),Te=A(fe),Le=d(fe,"BUTTON",{class:!0,"data-svelte-h":!0}),$(Le)!=="svelte-1f1friy"&&(Le.textContent=Ze),fe.forEach(_),re.forEach(_),me.forEach(_),this.h()},h(){i(l,"class","svelte-1rq3uou"),i(u,"for","role-name"),i(u,"class","svelte-1rq3uou"),i(f,"id","role-name"),i(f,"type","text"),i(f,"placeholder","editor"),i(f,"class","svelte-1rq3uou"),i(r,"class","form-group svelte-1rq3uou"),i(C,"for","role-display"),i(C,"class","svelte-1rq3uou"),i(p,"id","role-display"),i(p,"type","text"),i(p,"placeholder","Content Editor"),i(p,"class","svelte-1rq3uou"),i(g,"class","form-group svelte-1rq3uou"),i(b,"for","role-desc"),i(b,"class","svelte-1rq3uou"),i(I,"id","role-desc"),i(I,"placeholder","Can create and edit content"),i(I,"class","svelte-1rq3uou"),i(w,"class","form-group svelte-1rq3uou"),i(L,"class","svelte-1rq3uou"),i(O,"for","storage-quota"),i(O,"class","svelte-1rq3uou"),i(j,"id","storage-quota"),i(j,"type","number"),i(j,"class","svelte-1rq3uou"),i(B,"class","form-group svelte-1rq3uou"),i(q,"for","bandwidth-quota"),i(q,"class","svelte-1rq3uou"),i(G,"id","bandwidth-quota"),i(G,"type","number"),i(G,"class","svelte-1rq3uou"),i(S,"class","form-group svelte-1rq3uou"),i(Z,"for","upload-size"),i(Z,"class","svelte-1rq3uou"),i(K,"id","upload-size"),i(K,"type","number"),i(K,"class","svelte-1rq3uou"),i(ne,"class","form-group svelte-1rq3uou"),i(ue,"for","rate-limit"),i(ue,"class","svelte-1rq3uou"),i(he,"id","rate-limit"),i(he,"type","number"),i(he,"class","svelte-1rq3uou"),i(ce,"class","form-group svelte-1rq3uou"),i(ke,"class","btn svelte-1rq3uou"),i(Le,"class","btn btn-primary svelte-1rq3uou"),i(Ce,"class","modal-actions svelte-1rq3uou"),i(t,"class","modal svelte-1rq3uou"),i(e,"class","modal-overlay svelte-1rq3uou")},m(pe,me){M(pe,e,me),o(e,t),o(t,l),o(t,n),o(t,r),o(r,u),o(r,v),o(r,f),Y(f,s[0].name),o(t,m),o(t,g),o(g,C),o(g,E),o(g,p),Y(p,s[0].display_name),o(t,y),o(t,w),o(w,b),o(w,D),o(w,I),Y(I,s[0].description),o(t,V),o(t,L),o(t,R),o(t,B),o(B,O),o(B,J),o(B,j),Y(j,s[0].metadata.storage_quota),o(t,H),o(t,S),o(S,q),o(S,ie),o(S,G),Y(G,s[0].metadata.bandwidth_quota),o(t,oe),o(t,ne),o(ne,Z),o(ne,se),o(ne,K),Y(K,s[0].metadata.max_upload_size),o(t,X),o(t,ce),o(ce,ue),o(ce,_e),o(ce,he),Y(he,s[0].metadata.max_requests_per_min),o(t,ye),o(t,Ce),o(Ce,ke),o(Ce,Te),o(Ce,Le),Oe||(We=[U(f,"input",s[4]),U(p,"input",s[5]),U(I,"input",s[6]),U(j,"input",s[7]),U(G,"input",s[8]),U(K,"input",s[9]),U(he,"input",s[10]),U(ke,"click",s[2]),U(Le,"click",s[1]),U(t,"click",st(s[3])),U(e,"click",s[2])],Oe=!0)},p(pe,[me]){me&1&&f.value!==pe[0].name&&Y(f,pe[0].name),me&1&&p.value!==pe[0].display_name&&Y(p,pe[0].display_name),me&1&&Y(I,pe[0].description),me&1&&Qe(j.value)!==pe[0].metadata.storage_quota&&Y(j,pe[0].metadata.storage_quota),me&1&&Qe(G.value)!==pe[0].metadata.bandwidth_quota&&Y(G,pe[0].metadata.bandwidth_quota),me&1&&Qe(K.value)!==pe[0].metadata.max_upload_size&&Y(K,pe[0].metadata.max_upload_size),me&1&&Qe(he.value)!==pe[0].metadata.max_requests_per_min&&Y(he,pe[0].metadata.max_requests_per_min)},i:le,o:le,d(pe){pe&&_(e),Oe=!1,He(We)}}}function ol(s,e,t){const l=$e();let a={name:"",display_name:"",description:"",metadata:{storage_quota:1073741824,bandwidth_quota:10737418240,max_upload_size:104857600,max_requests_per_min:100,session_timeout:3600,disabled_features:[]}};function n(){l("create",a)}function r(){l("close")}function u(E){at.call(this,s,E)}function c(){a.name=this.value,t(0,a)}function v(){a.display_name=this.value,t(0,a)}function f(){a.description=this.value,t(0,a)}function m(){a.metadata.storage_quota=Qe(this.value),t(0,a)}function g(){a.metadata.bandwidth_quota=Qe(this.value),t(0,a)}function C(){a.metadata.max_upload_size=Qe(this.value),t(0,a)}function k(){a.metadata.max_requests_per_min=Qe(this.value),t(0,a)}return[a,n,r,u,c,v,f,m,g,C,k]}class rl extends Ne{constructor(e){super(),Ae(this,e,ol,nl,ze,{})}}function _t(s,e,t){const l=s.slice();return l[11]=e[t],l}function pt(s){let e,t,l,a,n=(s[0].display_name||s[0].name)+"",r,u,c,v,f,m="Display Name",g,C,k,E,p,y,w="Description",b,T,D,I,V='<h3 class="svelte-13ffg9l">Additional Settings</h3>',L,P,R,B,O,F="+ Add",J,j,H,S,q,ee="Cancel",ie,G,oe="Save Changes",ne,Z;function ge(X,ce){var ue;return((ue=X[1].metadata.disabled_features)==null?void 0:ue.length)>0?cl:il}let se=ge(s),K=se(s);return{c(){e=h("div"),t=h("div"),l=h("h2"),a=W("Edit Role: "),r=W(n),u=z(),c=h("div"),v=h("div"),f=h("label"),f.textContent=m,g=z(),C=h("input"),E=z(),p=h("div"),y=h("label"),y.textContent=w,b=z(),T=h("textarea"),D=z(),I=h("div"),I.innerHTML=V,L=z(),P=h("div"),R=h("label"),B=W(`Disabled Features
					`),O=h("button"),O.textContent=F,J=z(),j=h("div"),K.c(),H=z(),S=h("div"),q=h("button"),q.textContent=ee,ie=z(),G=h("button"),G.textContent=oe,this.h()},l(X){e=d(X,"DIV",{class:!0});var ce=N(e);t=d(ce,"DIV",{class:!0});var ue=N(t);l=d(ue,"H2",{class:!0});var de=N(l);a=Q(de,"Edit Role: "),r=Q(de,n),de.forEach(_),u=A(ue),c=d(ue,"DIV",{class:!0});var _e=N(c);v=d(_e,"DIV",{class:!0});var he=N(v);f=d(he,"LABEL",{for:!0,class:!0,"data-svelte-h":!0}),$(f)!=="svelte-1pn4scp"&&(f.textContent=m),g=A(he),C=d(he,"INPUT",{id:!0,type:!0,placeholder:!0,class:!0}),he.forEach(_),E=A(_e),p=d(_e,"DIV",{class:!0});var ye=N(p);y=d(ye,"LABEL",{for:!0,class:!0,"data-svelte-h":!0}),$(y)!=="svelte-1tds9bi"&&(y.textContent=w),b=A(ye),T=d(ye,"TEXTAREA",{id:!0,placeholder:!0,rows:!0,class:!0}),N(T).forEach(_),ye.forEach(_),D=A(_e),I=d(_e,"DIV",{class:!0,"data-svelte-h":!0}),$(I)!=="svelte-1flkym6"&&(I.innerHTML=V),L=A(_e),P=d(_e,"DIV",{class:!0});var Ce=N(P);R=d(Ce,"LABEL",{class:!0});var ke=N(R);B=Q(ke,`Disabled Features
					`),O=d(ke,"BUTTON",{class:!0,"data-svelte-h":!0}),$(O)!=="svelte-1o11z75"&&(O.textContent=F),ke.forEach(_),J=A(Ce),j=d(Ce,"DIV",{class:!0});var Be=N(j);K.l(Be),Be.forEach(_),Ce.forEach(_),_e.forEach(_),H=A(ue),S=d(ue,"DIV",{class:!0});var Te=N(S);q=d(Te,"BUTTON",{class:!0,"data-svelte-h":!0}),$(q)!=="svelte-rrbwep"&&(q.textContent=ee),ie=A(Te),G=d(Te,"BUTTON",{class:!0,"data-svelte-h":!0}),$(G)!=="svelte-10sa9gu"&&(G.textContent=oe),Te.forEach(_),ue.forEach(_),ce.forEach(_),this.h()},h(){i(l,"class","svelte-13ffg9l"),i(f,"for","display-name"),i(f,"class","svelte-13ffg9l"),i(C,"id","display-name"),i(C,"type","text"),i(C,"placeholder","Enter display name"),C.disabled=k=s[0].is_system,i(C,"class","svelte-13ffg9l"),i(v,"class","form-group svelte-13ffg9l"),i(y,"for","description"),i(y,"class","svelte-13ffg9l"),i(T,"id","description"),i(T,"placeholder","Enter role description"),i(T,"rows","2"),i(T,"class","svelte-13ffg9l"),i(p,"class","form-group svelte-13ffg9l"),i(I,"class","section-divider svelte-13ffg9l"),i(O,"class","btn-small svelte-13ffg9l"),i(R,"class","svelte-13ffg9l"),i(j,"class","features-list svelte-13ffg9l"),i(P,"class","form-group full-width svelte-13ffg9l"),i(c,"class","form-grid svelte-13ffg9l"),i(q,"class","btn svelte-13ffg9l"),i(G,"class","btn btn-primary svelte-13ffg9l"),i(S,"class","modal-actions svelte-13ffg9l"),i(t,"class","modal svelte-13ffg9l"),i(e,"class","modal-overlay svelte-13ffg9l")},m(X,ce){M(X,e,ce),o(e,t),o(t,l),o(l,a),o(l,r),o(t,u),o(t,c),o(c,v),o(v,f),o(v,g),o(v,C),Y(C,s[1].display_name),o(c,E),o(c,p),o(p,y),o(p,b),o(p,T),Y(T,s[1].description),o(c,D),o(c,I),o(c,L),o(c,P),o(P,R),o(R,B),o(R,O),o(P,J),o(P,j),K.m(j,null),o(t,H),o(t,S),o(S,q),o(S,ie),o(S,G),ne||(Z=[U(C,"input",s[7]),U(T,"input",s[8]),U(O,"click",tl(s[4])),U(q,"click",s[3]),U(G,"click",s[2]),U(t,"click",st(s[6])),U(e,"click",s[3])],ne=!0)},p(X,ce){ce&1&&n!==(n=(X[0].display_name||X[0].name)+"")&&te(r,n),ce&1&&k!==(k=X[0].is_system)&&(C.disabled=k),ce&2&&C.value!==X[1].display_name&&Y(C,X[1].display_name),ce&2&&Y(T,X[1].description),se===(se=ge(X))&&K?K.p(X,ce):(K.d(1),K=se(X),K&&(K.c(),K.m(j,null)))},d(X){X&&_(e),K.d(),ne=!1,He(Z)}}}function il(s){let e,t="No features disabled";return{c(){e=h("span"),e.textContent=t,this.h()},l(l){e=d(l,"SPAN",{class:!0,"data-svelte-h":!0}),$(e)!=="svelte-c0zbyy"&&(e.textContent=t),this.h()},h(){i(e,"class","no-features svelte-13ffg9l")},m(l,a){M(l,e,a)},p:le,d(l){l&&_(e)}}}function cl(s){let e,t=be(s[1].metadata.disabled_features),l=[];for(let a=0;a<t.length;a+=1)l[a]=mt(_t(s,t,a));return{c(){for(let a=0;a<l.length;a+=1)l[a].c();e=Ee()},l(a){for(let n=0;n<l.length;n+=1)l[n].l(a);e=Ee()},m(a,n){for(let r=0;r<l.length;r+=1)l[r]&&l[r].m(a,n);M(a,e,n)},p(a,n){if(n&34){t=be(a[1].metadata.disabled_features);let r;for(r=0;r<t.length;r+=1){const u=_t(a,t,r);l[r]?l[r].p(u,n):(l[r]=mt(u),l[r].c(),l[r].m(e.parentNode,e))}for(;r<l.length;r+=1)l[r].d(1);l.length=t.length}},d(a){a&&_(e),qe(l,a)}}}function mt(s){let e,t=s[11]+"",l,a,n,r="×",u,c,v;function f(){return s[9](s[11])}return{c(){e=h("span"),l=W(t),a=z(),n=h("button"),n.textContent=r,u=z(),this.h()},l(m){e=d(m,"SPAN",{class:!0});var g=N(e);l=Q(g,t),a=A(g),n=d(g,"BUTTON",{class:!0,"data-svelte-h":!0}),$(n)!=="svelte-1ednnqu"&&(n.textContent=r),u=A(g),g.forEach(_),this.h()},h(){i(n,"class","remove-btn svelte-13ffg9l"),i(e,"class","feature-tag svelte-13ffg9l")},m(m,g){M(m,e,g),o(e,l),o(e,a),o(e,n),o(e,u),c||(v=U(n,"click",f),c=!0)},p(m,g){s=m,g&2&&t!==(t=s[11]+"")&&te(l,t)},d(m){m&&_(e),c=!1,v()}}}function ul(s){let e,t=s[0]&&pt(s);return{c(){t&&t.c(),e=Ee()},l(l){t&&t.l(l),e=Ee()},m(l,a){t&&t.m(l,a),M(l,e,a)},p(l,[a]){l[0]?t?t.p(l,a):(t=pt(l),t.c(),t.m(e.parentNode,e)):t&&(t.d(1),t=null)},i:le,o:le,d(l){l&&_(e),t&&t.d(l)}}}function fl(s,e,t){let{role:l=null}=e;const a=$e();let n={};function r(){a("save",n)}function u(){a("close")}function c(){const k=prompt("Enter feature name to disable:");k&&!n.metadata.disabled_features.includes(k)&&t(1,n.metadata.disabled_features=[...n.metadata.disabled_features,k],n)}function v(k){t(1,n.metadata.disabled_features=n.metadata.disabled_features.filter(E=>E!==k),n)}function f(k){at.call(this,s,k)}function m(){n.display_name=this.value,t(1,n),t(0,l)}function g(){n.description=this.value,t(1,n),t(0,l)}const C=k=>v(k);return s.$$set=k=>{"role"in k&&t(0,l=k.role)},s.$$.update=()=>{var k;s.$$.dirty&1&&l&&t(1,n={...l,metadata:{...l.metadata,disabled_features:((k=l.metadata)==null?void 0:k.disabled_features)||[]}})},[l,n,r,u,c,v,f,m,g,C]}class dl extends Ne{constructor(e){super(),Ae(this,e,fl,ul,ze,{role:0})}}function bt(s,e,t){const l=s.slice();return l[12]=e[t],l}function gt(s){let e,t;return e=new al({props:{role:s[12]}}),e.$on("delete",s[5]),e.$on("edit",s[6]),{c(){Se(e.$$.fragment)},l(l){Re(e.$$.fragment,l)},m(l,a){Pe(e,l,a),t=!0},p(l,a){const n={};a&1&&(n.role=l[12]),e.$set(n)},i(l){t||(x(e.$$.fragment,l),t=!0)},o(l){ae(e.$$.fragment,l),t=!1},d(l){Ve(e,l)}}}function Ct(s){let e,t;return e=new rl({}),e.$on("create",s[4]),e.$on("close",s[9]),{c(){Se(e.$$.fragment)},l(l){Re(e.$$.fragment,l)},m(l,a){Pe(e,l,a),t=!0},p:le,i(l){t||(x(e.$$.fragment,l),t=!0)},o(l){ae(e.$$.fragment,l),t=!1},d(l){Ve(e,l)}}}function yt(s){let e,t;return e=new dl({props:{role:s[3]}}),e.$on("save",s[7]),e.$on("close",s[10]),{c(){Se(e.$$.fragment)},l(l){Re(e.$$.fragment,l)},m(l,a){Pe(e,l,a),t=!0},p(l,a){const n={};a&8&&(n.role=l[3]),e.$set(n)},i(l){t||(x(e.$$.fragment,l),t=!0)},o(l){ae(e.$$.fragment,l),t=!1},d(l){Ve(e,l)}}}function hl(s){let e,t,l,a="Roles",n,r,u="Create Role",c,v,f,m,g,C,k,E,p=be(s[0]),y=[];for(let D=0;D<p.length;D+=1)y[D]=gt(bt(s,p,D));const w=D=>ae(y[D],1,1,()=>{y[D]=null});let b=s[1]&&Ct(s),T=s[2]&&yt(s);return{c(){e=h("div"),t=h("div"),l=h("h2"),l.textContent=a,n=z(),r=h("button"),r.textContent=u,c=z(),v=h("div");for(let D=0;D<y.length;D+=1)y[D].c();f=z(),b&&b.c(),m=z(),T&&T.c(),g=Ee(),this.h()},l(D){e=d(D,"DIV",{class:!0});var I=N(e);t=d(I,"DIV",{class:!0});var V=N(t);l=d(V,"H2",{class:!0,"data-svelte-h":!0}),$(l)!=="svelte-2f6el"&&(l.textContent=a),n=A(V),r=d(V,"BUTTON",{class:!0,"data-svelte-h":!0}),$(r)!=="svelte-1uxw55m"&&(r.textContent=u),V.forEach(_),c=A(I),v=d(I,"DIV",{class:!0});var L=N(v);for(let P=0;P<y.length;P+=1)y[P].l(L);L.forEach(_),I.forEach(_),f=A(D),b&&b.l(D),m=A(D),T&&T.l(D),g=Ee(),this.h()},h(){i(l,"class","svelte-5f673k"),i(r,"class","btn btn-primary svelte-5f673k"),i(t,"class","section-header svelte-5f673k"),i(v,"class","roles-grid svelte-5f673k"),i(e,"class","section svelte-5f673k")},m(D,I){M(D,e,I),o(e,t),o(t,l),o(t,n),o(t,r),o(e,c),o(e,v);for(let V=0;V<y.length;V+=1)y[V]&&y[V].m(v,null);M(D,f,I),b&&b.m(D,I),M(D,m,I),T&&T.m(D,I),M(D,g,I),C=!0,k||(E=U(r,"click",s[8]),k=!0)},p(D,[I]){if(I&97){p=be(D[0]);let V;for(V=0;V<p.length;V+=1){const L=bt(D,p,V);y[V]?(y[V].p(L,I),x(y[V],1)):(y[V]=gt(L),y[V].c(),x(y[V],1),y[V].m(v,null))}for(je(),V=p.length;V<y.length;V+=1)w(V);Me()}D[1]?b?(b.p(D,I),I&2&&x(b,1)):(b=Ct(D),b.c(),x(b,1),b.m(m.parentNode,m)):b&&(je(),ae(b,1,1,()=>{b=null}),Me()),D[2]?T?(T.p(D,I),I&4&&x(T,1)):(T=yt(D),T.c(),x(T,1),T.m(g.parentNode,g)):T&&(je(),ae(T,1,1,()=>{T=null}),Me())},i(D){if(!C){for(let I=0;I<p.length;I+=1)x(y[I]);x(b),x(T),C=!0}},o(D){y=y.filter(Boolean);for(let I=0;I<y.length;I+=1)ae(y[I]);ae(b),ae(T),C=!1},d(D){D&&(_(e),_(f),_(m),_(g)),qe(y,D),b&&b.d(D),T&&T.d(D),k=!1,E()}}}function vl(s,e,t){let{roles:l=[]}=e;const a=$e();let n=!1,r=!1,u=null;async function c(E){const p=E.detail;(await fetch("/api/admin/iam/roles",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("auth_token")}`},body:JSON.stringify(p)})).ok?(a("rolesChanged"),t(1,n=!1)):alert("Failed to create role")}async function v(E){const p=E.detail;if(!confirm(`Are you sure you want to delete role "${p.display_name||p.name}"?`))return;const y=await fetch(`/api/admin/iam/roles/${p.name}`,{method:"DELETE",headers:{Authorization:`Bearer ${localStorage.getItem("auth_token")}`}});if(y.ok)a("rolesChanged");else{const w=await y.text();alert(`Failed to delete role: ${w}`)}}function f(E){t(3,u=E.detail),t(2,r=!0)}async function m(E){const p=E.detail;(await fetch(`/api/admin/iam/roles/${p.name}`,{method:"PUT",headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("auth_token")}`},body:JSON.stringify(p)})).ok?(a("rolesChanged"),t(2,r=!1),t(3,u=null)):alert("Failed to update role")}const g=()=>t(1,n=!0),C=()=>t(1,n=!1),k=()=>{t(2,r=!1),t(3,u=null)};return s.$$set=E=>{"roles"in E&&t(0,l=E.roles)},[l,n,r,u,c,v,f,m,g,C,k]}class _l extends Ne{constructor(e){super(),Ae(this,e,vl,hl,ze,{roles:0})}}function kt(s,e,t){const l=s.slice();return l[5]=e[t],l}function Et(s){let e,t,l=s[5].subject+"",a,n,r,u,c=s[5].resource+"",v,f,m,g,C=s[5].action+"",k,E,p,y,w=s[5].effect+"",b,T,D,I,V,L="Edit",P,R,B="Delete",O,F;function J(){return s[3](s[5])}function j(){return s[4](s[5])}return{c(){e=h("tr"),t=h("td"),a=W(l),n=z(),r=h("td"),u=h("code"),v=W(c),f=z(),m=h("td"),g=h("code"),k=W(C),E=z(),p=h("td"),y=h("span"),b=W(w),T=z(),D=h("td"),I=h("div"),V=h("button"),V.textContent=L,P=z(),R=h("button"),R.textContent=B,this.h()},l(H){e=d(H,"TR",{});var S=N(e);t=d(S,"TD",{class:!0});var q=N(t);a=Q(q,l),q.forEach(_),n=A(S),r=d(S,"TD",{class:!0});var ee=N(r);u=d(ee,"CODE",{class:!0});var ie=N(u);v=Q(ie,c),ie.forEach(_),ee.forEach(_),f=A(S),m=d(S,"TD",{class:!0});var G=N(m);g=d(G,"CODE",{class:!0});var oe=N(g);k=Q(oe,C),oe.forEach(_),G.forEach(_),E=A(S),p=d(S,"TD",{class:!0});var ne=N(p);y=d(ne,"SPAN",{class:!0});var Z=N(y);b=Q(Z,w),Z.forEach(_),ne.forEach(_),T=A(S),D=d(S,"TD",{class:!0});var ge=N(D);I=d(ge,"DIV",{class:!0});var se=N(I);V=d(se,"BUTTON",{class:!0,"data-svelte-h":!0}),$(V)!=="svelte-mktmsp"&&(V.textContent=L),P=A(se),R=d(se,"BUTTON",{class:!0,"data-svelte-h":!0}),$(R)!=="svelte-2nuqsz"&&(R.textContent=B),se.forEach(_),ge.forEach(_),S.forEach(_),this.h()},h(){i(t,"class","svelte-gf9xlt"),i(u,"class","svelte-gf9xlt"),i(r,"class","svelte-gf9xlt"),i(g,"class","svelte-gf9xlt"),i(m,"class","svelte-gf9xlt"),i(y,"class","badge svelte-gf9xlt"),ve(y,"allow",s[5].effect==="allow"),ve(y,"deny",s[5].effect==="deny"),i(p,"class","svelte-gf9xlt"),i(V,"class","btn btn-small svelte-gf9xlt"),i(R,"class","btn btn-small btn-danger svelte-gf9xlt"),i(I,"class","actions svelte-gf9xlt"),i(D,"class","svelte-gf9xlt")},m(H,S){M(H,e,S),o(e,t),o(t,a),o(e,n),o(e,r),o(r,u),o(u,v),o(e,f),o(e,m),o(m,g),o(g,k),o(e,E),o(e,p),o(p,y),o(y,b),o(e,T),o(e,D),o(D,I),o(I,V),o(I,P),o(I,R),O||(F=[U(V,"click",J),U(R,"click",j)],O=!0)},p(H,S){s=H,S&1&&l!==(l=s[5].subject+"")&&te(a,l),S&1&&c!==(c=s[5].resource+"")&&te(v,c),S&1&&C!==(C=s[5].action+"")&&te(k,C),S&1&&w!==(w=s[5].effect+"")&&te(b,w),S&1&&ve(y,"allow",s[5].effect==="allow"),S&1&&ve(y,"deny",s[5].effect==="deny")},d(H){H&&_(e),O=!1,He(F)}}}function Tt(s){let e,t='<td colspan="5" class="empty svelte-gf9xlt">No policies defined</td>';return{c(){e=h("tr"),e.innerHTML=t},l(l){e=d(l,"TR",{"data-svelte-h":!0}),$(e)!=="svelte-r77bzy"&&(e.innerHTML=t)},m(l,a){M(l,e,a)},d(l){l&&_(e)}}}function pl(s){let e,t,l='<tr><th class="svelte-gf9xlt">Subject</th> <th class="svelte-gf9xlt">Resource</th> <th class="svelte-gf9xlt">Action</th> <th class="svelte-gf9xlt">Effect</th> <th class="svelte-gf9xlt">Actions</th></tr>',a,n,r,u=be(s[0]),c=[];for(let f=0;f<u.length;f+=1)c[f]=Et(kt(s,u,f));let v=s[0].length===0&&Tt();return{c(){e=h("table"),t=h("thead"),t.innerHTML=l,a=z(),n=h("tbody");for(let f=0;f<c.length;f+=1)c[f].c();r=z(),v&&v.c(),this.h()},l(f){e=d(f,"TABLE",{class:!0});var m=N(e);t=d(m,"THEAD",{"data-svelte-h":!0}),$(t)!=="svelte-19st474"&&(t.innerHTML=l),a=A(m),n=d(m,"TBODY",{});var g=N(n);for(let C=0;C<c.length;C+=1)c[C].l(g);r=A(g),v&&v.l(g),g.forEach(_),m.forEach(_),this.h()},h(){i(e,"class","policies-table svelte-gf9xlt")},m(f,m){M(f,e,m),o(e,t),o(e,a),o(e,n);for(let g=0;g<c.length;g+=1)c[g]&&c[g].m(n,null);o(n,r),v&&v.m(n,null)},p(f,[m]){if(m&7){u=be(f[0]);let g;for(g=0;g<u.length;g+=1){const C=kt(f,u,g);c[g]?c[g].p(C,m):(c[g]=Et(C),c[g].c(),c[g].m(n,r))}for(;g<c.length;g+=1)c[g].d(1);c.length=u.length}f[0].length===0?v||(v=Tt(),v.c(),v.m(n,null)):v&&(v.d(1),v=null)},i:le,o:le,d(f){f&&_(e),qe(c,f),v&&v.d()}}}function ml(s,e,t){let{policies:l=[]}=e;const a=$e();function n(c){a("delete",c)}const r=c=>a("edit",c),u=c=>n(c);return s.$$set=c=>{"policies"in c&&t(0,l=c.policies)},[l,a,n,r,u]}class bl extends Ne{constructor(e){super(),Ae(this,e,ml,pl,ze,{policies:0})}}function gl(s){let e,t,l,a="Create New Policy",n,r,u,c="Subject (role or user ID)",v,f,m,g,C,k="Resource Pattern",E,p,y,w,b,T="Action Pattern",D,I,V,L,P,R="Effect",B,O,F,J="Allow",j,H="Deny",S,q,ee,ie="Cancel",G,oe,ne="Create",Z,ge;return{c(){e=h("div"),t=h("div"),l=h("h2"),l.textContent=a,n=z(),r=h("div"),u=h("label"),u.textContent=c,v=z(),f=h("input"),m=z(),g=h("div"),C=h("label"),C.textContent=k,E=z(),p=h("input"),y=z(),w=h("div"),b=h("label"),b.textContent=T,D=z(),I=h("input"),V=z(),L=h("div"),P=h("label"),P.textContent=R,B=z(),O=h("select"),F=h("option"),F.textContent=J,j=h("option"),j.textContent=H,S=z(),q=h("div"),ee=h("button"),ee.textContent=ie,G=z(),oe=h("button"),oe.textContent=ne,this.h()},l(se){e=d(se,"DIV",{class:!0});var K=N(e);t=d(K,"DIV",{class:!0});var X=N(t);l=d(X,"H2",{class:!0,"data-svelte-h":!0}),$(l)!=="svelte-rbzkd2"&&(l.textContent=a),n=A(X),r=d(X,"DIV",{class:!0});var ce=N(r);u=d(ce,"LABEL",{for:!0,class:!0,"data-svelte-h":!0}),$(u)!=="svelte-1l83r1h"&&(u.textContent=c),v=A(ce),f=d(ce,"INPUT",{id:!0,type:!0,placeholder:!0,class:!0}),ce.forEach(_),m=A(X),g=d(X,"DIV",{class:!0});var ue=N(g);C=d(ue,"LABEL",{for:!0,class:!0,"data-svelte-h":!0}),$(C)!=="svelte-15pd6fz"&&(C.textContent=k),E=A(ue),p=d(ue,"INPUT",{id:!0,type:!0,placeholder:!0,class:!0}),ue.forEach(_),y=A(X),w=d(X,"DIV",{class:!0});var de=N(w);b=d(de,"LABEL",{for:!0,class:!0,"data-svelte-h":!0}),$(b)!=="svelte-wvua1z"&&(b.textContent=T),D=A(de),I=d(de,"INPUT",{id:!0,type:!0,placeholder:!0,class:!0}),de.forEach(_),V=A(X),L=d(X,"DIV",{class:!0});var _e=N(L);P=d(_e,"LABEL",{for:!0,class:!0,"data-svelte-h":!0}),$(P)!=="svelte-3idu6h"&&(P.textContent=R),B=A(_e),O=d(_e,"SELECT",{id:!0,class:!0});var he=N(O);F=d(he,"OPTION",{"data-svelte-h":!0}),$(F)!=="svelte-1uempdw"&&(F.textContent=J),j=d(he,"OPTION",{"data-svelte-h":!0}),$(j)!=="svelte-1db5bva"&&(j.textContent=H),he.forEach(_),_e.forEach(_),S=A(X),q=d(X,"DIV",{class:!0});var ye=N(q);ee=d(ye,"BUTTON",{class:!0,"data-svelte-h":!0}),$(ee)!=="svelte-rrbwep"&&(ee.textContent=ie),G=A(ye),oe=d(ye,"BUTTON",{class:!0,"data-svelte-h":!0}),$(oe)!=="svelte-1f1friy"&&(oe.textContent=ne),ye.forEach(_),X.forEach(_),K.forEach(_),this.h()},h(){i(l,"class","svelte-15yobup"),i(u,"for","policy-subject"),i(u,"class","svelte-15yobup"),i(f,"id","policy-subject"),i(f,"type","text"),i(f,"placeholder","editor"),i(f,"class","svelte-15yobup"),i(r,"class","form-group svelte-15yobup"),i(C,"for","policy-resource"),i(C,"class","svelte-15yobup"),i(p,"id","policy-resource"),i(p,"type","text"),i(p,"placeholder","/api/storage/*"),i(p,"class","svelte-15yobup"),i(g,"class","form-group svelte-15yobup"),i(b,"for","policy-action"),i(b,"class","svelte-15yobup"),i(I,"id","policy-action"),i(I,"type","text"),i(I,"placeholder","read|write"),i(I,"class","svelte-15yobup"),i(w,"class","form-group svelte-15yobup"),i(P,"for","policy-effect"),i(P,"class","svelte-15yobup"),F.__value="allow",Y(F,F.__value),j.__value="deny",Y(j,j.__value),i(O,"id","policy-effect"),i(O,"class","svelte-15yobup"),s[0].effect===void 0&&ct(()=>s[7].call(O)),i(L,"class","form-group svelte-15yobup"),i(ee,"class","btn svelte-15yobup"),i(oe,"class","btn btn-primary svelte-15yobup"),i(q,"class","modal-actions svelte-15yobup"),i(t,"class","modal svelte-15yobup"),i(e,"class","modal-overlay svelte-15yobup")},m(se,K){M(se,e,K),o(e,t),o(t,l),o(t,n),o(t,r),o(r,u),o(r,v),o(r,f),Y(f,s[0].subject),o(t,m),o(t,g),o(g,C),o(g,E),o(g,p),Y(p,s[0].resource),o(t,y),o(t,w),o(w,b),o(w,D),o(w,I),Y(I,s[0].action),o(t,V),o(t,L),o(L,P),o(L,B),o(L,O),o(O,F),o(O,j),lt(O,s[0].effect,!0),o(t,S),o(t,q),o(q,ee),o(q,G),o(q,oe),Z||(ge=[U(f,"input",s[4]),U(p,"input",s[5]),U(I,"input",s[6]),U(O,"change",s[7]),U(ee,"click",s[2]),U(oe,"click",s[1]),U(t,"click",st(s[3])),U(e,"click",s[2])],Z=!0)},p(se,[K]){K&1&&f.value!==se[0].subject&&Y(f,se[0].subject),K&1&&p.value!==se[0].resource&&Y(p,se[0].resource),K&1&&I.value!==se[0].action&&Y(I,se[0].action),K&1&&lt(O,se[0].effect)},i:le,o:le,d(se){se&&_(e),Z=!1,He(ge)}}}function Cl(s,e,t){const l=$e();let a={subject:"",resource:"",action:"",effect:"allow"};function n(){l("create",a)}function r(){l("close")}function u(g){at.call(this,s,g)}function c(){a.subject=this.value,t(0,a)}function v(){a.resource=this.value,t(0,a)}function f(){a.action=this.value,t(0,a)}function m(){a.effect=ut(this),t(0,a)}return[a,n,r,u,c,v,f,m]}class yl extends Ne{constructor(e){super(),Ae(this,e,Cl,gl,ze,{})}}function wt(s){let e,t,l,a="Edit Policy",n,r,u,c="Subject (role or user ID)",v,f,m,g,C,k="Resource Pattern",E,p,y,w,b="Use * for wildcards (e.g., /api/users/* or *)",T,D,I,V="Action Pattern",L,P,R,B,O="Use | for multiple actions (e.g., read|write|delete or *)",F,J,j,H="Effect",S,q,ee,ie="Allow",G,oe="Deny",ne,Z,ge="Deny rules take precedence over allow rules",se,K,X,ce="Policy Preview:",ue,de,_e=s[1].effect==="allow"?"ALLOW":"DENY",he,ye,Ce=(s[1].subject||"...")+"",ke,Be,Te=(s[1].action||"...")+"",Le,Ze,Oe=(s[1].resource||"...")+"",We,pe,me,re,Xe="Cancel",Fe,we,Je,Ue,Ge,Ke;return{c(){e=h("div"),t=h("div"),l=h("h2"),l.textContent=a,n=z(),r=h("div"),u=h("label"),u.textContent=c,v=z(),f=h("input"),m=z(),g=h("div"),C=h("label"),C.textContent=k,E=z(),p=h("input"),y=z(),w=h("small"),w.textContent=b,T=z(),D=h("div"),I=h("label"),I.textContent=V,L=z(),P=h("input"),R=z(),B=h("small"),B.textContent=O,F=z(),J=h("div"),j=h("label"),j.textContent=H,S=z(),q=h("select"),ee=h("option"),ee.textContent=ie,G=h("option"),G.textContent=oe,ne=z(),Z=h("small"),Z.textContent=ge,se=z(),K=h("div"),X=h("h4"),X.textContent=ce,ue=z(),de=h("code"),he=W(_e),ye=z(),ke=W(Ce),Be=W(` to 
				`),Le=W(Te),Ze=W(` on 
				`),We=W(Oe),pe=z(),me=h("div"),re=h("button"),re.textContent=Xe,Fe=z(),we=h("button"),Je=W("Save Changes"),this.h()},l(fe){e=d(fe,"DIV",{class:!0});var Ie=N(e);t=d(Ie,"DIV",{class:!0});var De=N(t);l=d(De,"H2",{class:!0,"data-svelte-h":!0}),$(l)!=="svelte-k4p0so"&&(l.textContent=a),n=A(De),r=d(De,"DIV",{class:!0});var nt=N(r);u=d(nt,"LABEL",{for:!0,class:!0,"data-svelte-h":!0}),$(u)!=="svelte-1l83r1h"&&(u.textContent=c),v=A(nt),f=d(nt,"INPUT",{id:!0,type:!0,placeholder:!0,class:!0}),nt.forEach(_),m=A(De),g=d(De,"DIV",{class:!0});var xe=N(g);C=d(xe,"LABEL",{for:!0,class:!0,"data-svelte-h":!0}),$(C)!=="svelte-15pd6fz"&&(C.textContent=k),E=A(xe),p=d(xe,"INPUT",{id:!0,type:!0,placeholder:!0,class:!0}),y=A(xe),w=d(xe,"SMALL",{class:!0,"data-svelte-h":!0}),$(w)!=="svelte-yzb00u"&&(w.textContent=b),xe.forEach(_),T=A(De),D=d(De,"DIV",{class:!0});var et=N(D);I=d(et,"LABEL",{for:!0,class:!0,"data-svelte-h":!0}),$(I)!=="svelte-wvua1z"&&(I.textContent=V),L=A(et),P=d(et,"INPUT",{id:!0,type:!0,placeholder:!0,class:!0}),R=A(et),B=d(et,"SMALL",{class:!0,"data-svelte-h":!0}),$(B)!=="svelte-jssw4p"&&(B.textContent=O),et.forEach(_),F=A(De),J=d(De,"DIV",{class:!0});var tt=N(J);j=d(tt,"LABEL",{for:!0,class:!0,"data-svelte-h":!0}),$(j)!=="svelte-3idu6h"&&(j.textContent=H),S=A(tt),q=d(tt,"SELECT",{id:!0,class:!0});var it=N(q);ee=d(it,"OPTION",{"data-svelte-h":!0}),$(ee)!=="svelte-1uempdw"&&(ee.textContent=ie),G=d(it,"OPTION",{"data-svelte-h":!0}),$(G)!=="svelte-1db5bva"&&(G.textContent=oe),it.forEach(_),ne=A(tt),Z=d(tt,"SMALL",{class:!0,"data-svelte-h":!0}),$(Z)!=="svelte-4een4q"&&(Z.textContent=ge),tt.forEach(_),se=A(De),K=d(De,"DIV",{class:!0});var ot=N(K);X=d(ot,"H4",{class:!0,"data-svelte-h":!0}),$(X)!=="svelte-zyi5la"&&(X.textContent=ce),ue=A(ot),de=d(ot,"CODE",{class:!0});var Ye=N(de);he=Q(Ye,_e),ye=A(Ye),ke=Q(Ye,Ce),Be=Q(Ye,` to 
				`),Le=Q(Ye,Te),Ze=Q(Ye,` on 
				`),We=Q(Ye,Oe),Ye.forEach(_),ot.forEach(_),pe=A(De),me=d(De,"DIV",{class:!0});var rt=N(me);re=d(rt,"BUTTON",{class:!0,"data-svelte-h":!0}),$(re)!=="svelte-rrbwep"&&(re.textContent=Xe),Fe=A(rt),we=d(rt,"BUTTON",{class:!0});var ft=N(we);Je=Q(ft,"Save Changes"),ft.forEach(_),rt.forEach(_),De.forEach(_),Ie.forEach(_),this.h()},h(){i(l,"class","svelte-sqrd5l"),i(u,"for","policy-subject"),i(u,"class","svelte-sqrd5l"),i(f,"id","policy-subject"),i(f,"type","text"),i(f,"placeholder","editor"),i(f,"class","svelte-sqrd5l"),i(r,"class","form-group svelte-sqrd5l"),i(C,"for","policy-resource"),i(C,"class","svelte-sqrd5l"),i(p,"id","policy-resource"),i(p,"type","text"),i(p,"placeholder","/api/storage/*"),i(p,"class","svelte-sqrd5l"),i(w,"class","svelte-sqrd5l"),i(g,"class","form-group svelte-sqrd5l"),i(I,"for","policy-action"),i(I,"class","svelte-sqrd5l"),i(P,"id","policy-action"),i(P,"type","text"),i(P,"placeholder","read|write"),i(P,"class","svelte-sqrd5l"),i(B,"class","svelte-sqrd5l"),i(D,"class","form-group svelte-sqrd5l"),i(j,"for","policy-effect"),i(j,"class","svelte-sqrd5l"),ee.__value="allow",Y(ee,ee.__value),G.__value="deny",Y(G,G.__value),i(q,"id","policy-effect"),i(q,"class","svelte-sqrd5l"),s[1].effect===void 0&&ct(()=>s[8].call(q)),i(Z,"class","svelte-sqrd5l"),i(J,"class","form-group svelte-sqrd5l"),i(X,"class","svelte-sqrd5l"),i(de,"class","svelte-sqrd5l"),i(K,"class","policy-preview svelte-sqrd5l"),i(re,"class","btn svelte-sqrd5l"),i(we,"class","btn btn-primary svelte-sqrd5l"),we.disabled=Ue=!s[1].subject||!s[1].resource||!s[1].action,i(me,"class","modal-actions svelte-sqrd5l"),i(t,"class","modal svelte-sqrd5l"),i(e,"class","modal-overlay svelte-sqrd5l")},m(fe,Ie){M(fe,e,Ie),o(e,t),o(t,l),o(t,n),o(t,r),o(r,u),o(r,v),o(r,f),Y(f,s[1].subject),o(t,m),o(t,g),o(g,C),o(g,E),o(g,p),Y(p,s[1].resource),o(g,y),o(g,w),o(t,T),o(t,D),o(D,I),o(D,L),o(D,P),Y(P,s[1].action),o(D,R),o(D,B),o(t,F),o(t,J),o(J,j),o(J,S),o(J,q),o(q,ee),o(q,G),lt(q,s[1].effect,!0),o(J,ne),o(J,Z),o(t,se),o(t,K),o(K,X),o(K,ue),o(K,de),o(de,he),o(de,ye),o(de,ke),o(de,Be),o(de,Le),o(de,Ze),o(de,We),o(t,pe),o(t,me),o(me,re),o(me,Fe),o(me,we),o(we,Je),Ge||(Ke=[U(f,"input",s[5]),U(p,"input",s[6]),U(P,"input",s[7]),U(q,"change",s[8]),U(re,"click",s[3]),U(we,"click",s[2]),U(t,"click",st(s[4])),U(e,"click",s[3])],Ge=!0)},p(fe,Ie){Ie&2&&f.value!==fe[1].subject&&Y(f,fe[1].subject),Ie&2&&p.value!==fe[1].resource&&Y(p,fe[1].resource),Ie&2&&P.value!==fe[1].action&&Y(P,fe[1].action),Ie&2&&lt(q,fe[1].effect),Ie&2&&_e!==(_e=fe[1].effect==="allow"?"ALLOW":"DENY")&&te(he,_e),Ie&2&&Ce!==(Ce=(fe[1].subject||"...")+"")&&te(ke,Ce),Ie&2&&Te!==(Te=(fe[1].action||"...")+"")&&te(Le,Te),Ie&2&&Oe!==(Oe=(fe[1].resource||"...")+"")&&te(We,Oe),Ie&2&&Ue!==(Ue=!fe[1].subject||!fe[1].resource||!fe[1].action)&&(we.disabled=Ue)},d(fe){fe&&_(e),Ge=!1,He(Ke)}}}function kl(s){let e,t=s[0]&&wt(s);return{c(){t&&t.c(),e=Ee()},l(l){t&&t.l(l),e=Ee()},m(l,a){t&&t.m(l,a),M(l,e,a)},p(l,[a]){l[0]?t?t.p(l,a):(t=wt(l),t.c(),t.m(e.parentNode,e)):t&&(t.d(1),t=null)},i:le,o:le,d(l){l&&_(e),t&&t.d(l)}}}function El(s,e,t){let{policy:l=null}=e;const a=$e();let n={};function r(){a("save",n)}function u(){a("close")}function c(C){at.call(this,s,C)}function v(){n.subject=this.value,t(1,n),t(0,l)}function f(){n.resource=this.value,t(1,n),t(0,l)}function m(){n.action=this.value,t(1,n),t(0,l)}function g(){n.effect=ut(this),t(1,n),t(0,l)}return s.$$set=C=>{"policy"in C&&t(0,l=C.policy)},s.$$.update=()=>{s.$$.dirty&1&&l&&t(1,n={...l})},[l,n,r,u,c,v,f,m,g]}class Tl extends Ne{constructor(e){super(),Ae(this,e,El,kl,ze,{policy:0})}}function It(s){let e,t;return e=new yl({}),e.$on("create",s[4]),e.$on("close",s[9]),{c(){Se(e.$$.fragment)},l(l){Re(e.$$.fragment,l)},m(l,a){Pe(e,l,a),t=!0},p:le,i(l){t||(x(e.$$.fragment,l),t=!0)},o(l){ae(e.$$.fragment,l),t=!1},d(l){Ve(e,l)}}}function Dt(s){let e,t;return e=new Tl({props:{policy:s[3]}}),e.$on("save",s[7]),e.$on("close",s[10]),{c(){Se(e.$$.fragment)},l(l){Re(e.$$.fragment,l)},m(l,a){Pe(e,l,a),t=!0},p(l,a){const n={};a&8&&(n.policy=l[3]),e.$set(n)},i(l){t||(x(e.$$.fragment,l),t=!0)},o(l){ae(e.$$.fragment,l),t=!1},d(l){Ve(e,l)}}}function wl(s){let e,t,l,a="Policies",n,r,u="Create Policy",c,v,f,m,g,C,k,E;v=new bl({props:{policies:s[0]}}),v.$on("delete",s[5]),v.$on("edit",s[6]);let p=s[1]&&It(s),y=s[2]&&Dt(s);return{c(){e=h("div"),t=h("div"),l=h("h2"),l.textContent=a,n=z(),r=h("button"),r.textContent=u,c=z(),Se(v.$$.fragment),f=z(),p&&p.c(),m=z(),y&&y.c(),g=Ee(),this.h()},l(w){e=d(w,"DIV",{class:!0});var b=N(e);t=d(b,"DIV",{class:!0});var T=N(t);l=d(T,"H2",{class:!0,"data-svelte-h":!0}),$(l)!=="svelte-17cnnxs"&&(l.textContent=a),n=A(T),r=d(T,"BUTTON",{class:!0,"data-svelte-h":!0}),$(r)!=="svelte-c6331w"&&(r.textContent=u),T.forEach(_),c=A(b),Re(v.$$.fragment,b),b.forEach(_),f=A(w),p&&p.l(w),m=A(w),y&&y.l(w),g=Ee(),this.h()},h(){i(l,"class","svelte-1vq6bo7"),i(r,"class","btn btn-primary svelte-1vq6bo7"),i(t,"class","section-header svelte-1vq6bo7"),i(e,"class","section svelte-1vq6bo7")},m(w,b){M(w,e,b),o(e,t),o(t,l),o(t,n),o(t,r),o(e,c),Pe(v,e,null),M(w,f,b),p&&p.m(w,b),M(w,m,b),y&&y.m(w,b),M(w,g,b),C=!0,k||(E=U(r,"click",s[8]),k=!0)},p(w,[b]){const T={};b&1&&(T.policies=w[0]),v.$set(T),w[1]?p?(p.p(w,b),b&2&&x(p,1)):(p=It(w),p.c(),x(p,1),p.m(m.parentNode,m)):p&&(je(),ae(p,1,1,()=>{p=null}),Me()),w[2]?y?(y.p(w,b),b&4&&x(y,1)):(y=Dt(w),y.c(),x(y,1),y.m(g.parentNode,g)):y&&(je(),ae(y,1,1,()=>{y=null}),Me())},i(w){C||(x(v.$$.fragment,w),x(p),x(y),C=!0)},o(w){ae(v.$$.fragment,w),ae(p),ae(y),C=!1},d(w){w&&(_(e),_(f),_(m),_(g)),Ve(v),p&&p.d(w),y&&y.d(w),k=!1,E()}}}function Il(s,e,t){let{policies:l=[]}=e;const a=$e();let n=!1,r=!1,u=null;async function c(E){const p=E.detail;(await fetch("/api/admin/iam/policies",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("auth_token")}`},body:JSON.stringify(p)})).ok?(a("policiesChanged"),t(1,n=!1)):alert("Failed to create policy")}async function v(E){const p=E.detail;if(!confirm("Are you sure you want to delete this policy?"))return;(await fetch("/api/admin/iam/policies",{method:"DELETE",headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("auth_token")}`},body:JSON.stringify(p)})).ok?a("policiesChanged"):alert("Failed to delete policy")}function f(E){t(3,u=E.detail),t(2,r=!0)}async function m(E){const p=E.detail;(await fetch("/api/admin/iam/policies",{method:"DELETE",headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("auth_token")}`},body:JSON.stringify(u)})).ok&&(await fetch("/api/admin/iam/policies",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("auth_token")}`},body:JSON.stringify(p)})).ok?(a("policiesChanged"),t(2,r=!1),t(3,u=null)):alert("Failed to update policy")}const g=()=>t(1,n=!0),C=()=>t(1,n=!1),k=()=>{t(2,r=!1),t(3,u=null)};return s.$$set=E=>{"policies"in E&&t(0,l=E.policies)},[l,n,r,u,c,v,f,m,g,C,k]}class Dl extends Ne{constructor(e){super(),Ae(this,e,Il,wl,ze,{policies:0})}}function Nt(s,e,t){const l=s.slice();return l[5]=e[t],l}function Nl(s){let e,t="No roles assigned";return{c(){e=h("span"),e.textContent=t,this.h()},l(l){e=d(l,"SPAN",{class:!0,"data-svelte-h":!0}),$(e)!=="svelte-q2xp12"&&(e.textContent=t),this.h()},h(){i(e,"class","no-roles svelte-1wwcc7i")},m(l,a){M(l,e,a)},p:le,d(l){l&&_(e)}}}function Al(s){let e,t=be(s[0].roles),l=[];for(let a=0;a<t.length;a+=1)l[a]=At(Nt(s,t,a));return{c(){for(let a=0;a<l.length;a+=1)l[a].c();e=Ee()},l(a){for(let n=0;n<l.length;n+=1)l[n].l(a);e=Ee()},m(a,n){for(let r=0;r<l.length;r+=1)l[r]&&l[r].m(a,n);M(a,e,n)},p(a,n){if(n&3){t=be(a[0].roles);let r;for(r=0;r<t.length;r+=1){const u=Nt(a,t,r);l[r]?l[r].p(u,n):(l[r]=At(u),l[r].c(),l[r].m(e.parentNode,e))}for(;r<l.length;r+=1)l[r].d(1);l.length=t.length}},d(a){a&&_(e),qe(l,a)}}}function At(s){let e,t=(s[5].display_name||s[5].name)+"",l,a,n,r="×",u,c,v;function f(){return s[3](s[5])}return{c(){e=h("span"),l=W(t),a=z(),n=h("button"),n.textContent=r,u=z(),this.h()},l(m){e=d(m,"SPAN",{class:!0});var g=N(e);l=Q(g,t),a=A(g),n=d(g,"BUTTON",{class:!0,"data-svelte-h":!0}),$(n)!=="svelte-wmg03n"&&(n.textContent=r),u=A(g),g.forEach(_),this.h()},h(){i(n,"class","remove-role svelte-1wwcc7i"),i(e,"class","role-tag svelte-1wwcc7i")},m(m,g){M(m,e,g),o(e,l),o(e,a),o(e,n),o(e,u),c||(v=U(n,"click",f),c=!0)},p(m,g){s=m,g&1&&t!==(t=(s[5].display_name||s[5].name)+"")&&te(l,t)},d(m){m&&_(e),c=!1,v()}}}function zl(s){let e,t,l=s[0].first_name+"",a,n,r=s[0].last_name+"",u,c,v,f=s[0].email+"",m,g,C,k,E,p,y,w="Assign Role",b,T;function D(L,P){return L[0].roles&&L[0].roles.length>0?Al:Nl}let I=D(s),V=I(s);return{c(){e=h("tr"),t=h("td"),a=W(l),n=z(),u=W(r),c=z(),v=h("td"),m=W(f),g=z(),C=h("td"),k=h("div"),V.c(),E=z(),p=h("td"),y=h("button"),y.textContent=w,this.h()},l(L){e=d(L,"TR",{});var P=N(e);t=d(P,"TD",{class:!0});var R=N(t);a=Q(R,l),n=A(R),u=Q(R,r),R.forEach(_),c=A(P),v=d(P,"TD",{class:!0});var B=N(v);m=Q(B,f),B.forEach(_),g=A(P),C=d(P,"TD",{class:!0});var O=N(C);k=d(O,"DIV",{class:!0});var F=N(k);V.l(F),F.forEach(_),O.forEach(_),E=A(P),p=d(P,"TD",{class:!0});var J=N(p);y=d(J,"BUTTON",{class:!0,"data-svelte-h":!0}),$(y)!=="svelte-80rudk"&&(y.textContent=w),J.forEach(_),P.forEach(_),this.h()},h(){i(t,"class","svelte-1wwcc7i"),i(v,"class","svelte-1wwcc7i"),i(k,"class","user-roles svelte-1wwcc7i"),i(C,"class","svelte-1wwcc7i"),i(y,"class","btn btn-small svelte-1wwcc7i"),i(p,"class","svelte-1wwcc7i")},m(L,P){M(L,e,P),o(e,t),o(t,a),o(t,n),o(t,u),o(e,c),o(e,v),o(v,m),o(e,g),o(e,C),o(C,k),V.m(k,null),o(e,E),o(e,p),o(p,y),b||(T=U(y,"click",s[2]),b=!0)},p(L,[P]){P&1&&l!==(l=L[0].first_name+"")&&te(a,l),P&1&&r!==(r=L[0].last_name+"")&&te(u,r),P&1&&f!==(f=L[0].email+"")&&te(m,f),I===(I=D(L))&&V?V.p(L,P):(V.d(1),V=I(L),V&&(V.c(),V.m(k,null)))},i:le,o:le,d(L){L&&_(e),V.d(),b=!1,T()}}}function Ll(s,e,t){let{user:l}=e;const a=$e();function n(c){a("removeRole",{userId:l.id,roleName:c})}function r(){a("assignRole")}const u=c=>n(c.name);return s.$$set=c=>{"user"in c&&t(0,l=c.user)},[l,n,r,u]}class Vl extends Ne{constructor(e){super(),Ae(this,e,Ll,zl,ze,{user:0})}}function zt(s,e,t){const l=s.slice();return l[7]=e[t],l}function Lt(s){let e,t,l=(s[7].display_name||s[7].name)+"",a,n,r,u=s[7].description+"",c,v,f,m;function g(){return s[5](s[7])}return{c(){e=h("button"),t=h("h4"),a=W(l),n=z(),r=h("p"),c=W(u),v=z(),this.h()},l(C){e=d(C,"BUTTON",{class:!0});var k=N(e);t=d(k,"H4",{class:!0});var E=N(t);a=Q(E,l),E.forEach(_),n=A(k),r=d(k,"P",{class:!0});var p=N(r);c=Q(p,u),p.forEach(_),v=A(k),k.forEach(_),this.h()},h(){i(t,"class","svelte-13vp5tv"),i(r,"class","svelte-13vp5tv"),i(e,"class","role-option svelte-13vp5tv")},m(C,k){M(C,e,k),o(e,t),o(t,a),o(e,n),o(e,r),o(r,c),o(e,v),f||(m=U(e,"click",g),f=!0)},p(C,k){s=C,k&2&&l!==(l=(s[7].display_name||s[7].name)+"")&&te(a,l),k&2&&u!==(u=s[7].description+"")&&te(c,u)},d(C){C&&_(e),f=!1,m()}}}function Pl(s){let e,t,l,a,n=s[0].email+"",r,u,c,v,f,m,g="Cancel",C,k,E=be(s[1]),p=[];for(let y=0;y<E.length;y+=1)p[y]=Lt(zt(s,E,y));return{c(){e=h("div"),t=h("div"),l=h("h2"),a=W("Assign Role to "),r=W(n),u=z(),c=h("div");for(let y=0;y<p.length;y+=1)p[y].c();v=z(),f=h("div"),m=h("button"),m.textContent=g,this.h()},l(y){e=d(y,"DIV",{class:!0});var w=N(e);t=d(w,"DIV",{class:!0});var b=N(t);l=d(b,"H2",{class:!0});var T=N(l);a=Q(T,"Assign Role to "),r=Q(T,n),T.forEach(_),u=A(b),c=d(b,"DIV",{class:!0});var D=N(c);for(let V=0;V<p.length;V+=1)p[V].l(D);D.forEach(_),v=A(b),f=d(b,"DIV",{class:!0});var I=N(f);m=d(I,"BUTTON",{class:!0,"data-svelte-h":!0}),$(m)!=="svelte-rrbwep"&&(m.textContent=g),I.forEach(_),b.forEach(_),w.forEach(_),this.h()},h(){i(l,"class","svelte-13vp5tv"),i(c,"class","role-options svelte-13vp5tv"),i(m,"class","btn svelte-13vp5tv"),i(f,"class","modal-actions svelte-13vp5tv"),i(t,"class","modal svelte-13vp5tv"),i(e,"class","modal-overlay svelte-13vp5tv")},m(y,w){M(y,e,w),o(e,t),o(t,l),o(l,a),o(l,r),o(t,u),o(t,c);for(let b=0;b<p.length;b+=1)p[b]&&p[b].m(c,null);o(t,v),o(t,f),o(f,m),C||(k=[U(m,"click",s[3]),U(t,"click",st(s[4])),U(e,"click",s[3])],C=!0)},p(y,[w]){if(w&1&&n!==(n=y[0].email+"")&&te(r,n),w&6){E=be(y[1]);let b;for(b=0;b<E.length;b+=1){const T=zt(y,E,b);p[b]?p[b].p(T,w):(p[b]=Lt(T),p[b].c(),p[b].m(c,null))}for(;b<p.length;b+=1)p[b].d(1);p.length=E.length}},i:le,o:le,d(y){y&&_(e),qe(p,y),C=!1,He(k)}}}function Rl(s,e,t){let{user:l}=e,{roles:a=[]}=e;const n=$e();function r(f){n("assign",{userId:l.id,roleName:f})}function u(){n("close")}function c(f){at.call(this,s,f)}const v=f=>r(f.name);return s.$$set=f=>{"user"in f&&t(0,l=f.user),"roles"in f&&t(1,a=f.roles)},[l,a,r,u,c,v]}class Sl extends Ne{constructor(e){super(),Ae(this,e,Rl,Pl,ze,{user:0,roles:1})}}function Vt(s,e,t){const l=s.slice();return l[10]=e[t],l}function Pt(s){let e,t;function l(){return s[7](s[10])}return e=new Vl({props:{user:s[10]}}),e.$on("assignRole",l),e.$on("removeRole",s[6]),{c(){Se(e.$$.fragment)},l(a){Re(e.$$.fragment,a)},m(a,n){Pe(e,a,n),t=!0},p(a,n){s=a;const r={};n&1&&(r.user=s[10]),e.$set(r)},i(a){t||(x(e.$$.fragment,a),t=!0)},o(a){ae(e.$$.fragment,a),t=!1},d(a){Ve(e,a)}}}function Rt(s){let e,t='<td colspan="4" class="empty svelte-1frtfmv">No users found</td>';return{c(){e=h("tr"),e.innerHTML=t},l(l){e=d(l,"TR",{"data-svelte-h":!0}),$(e)!=="svelte-1okihcc"&&(e.innerHTML=t)},m(l,a){M(l,e,a)},d(l){l&&_(e)}}}function St(s){let e,t;return e=new Sl({props:{user:s[2],roles:s[1]}}),e.$on("assign",s[5]),e.$on("close",s[8]),{c(){Se(e.$$.fragment)},l(l){Re(e.$$.fragment,l)},m(l,a){Pe(e,l,a),t=!0},p(l,a){const n={};a&4&&(n.user=l[2]),a&2&&(n.roles=l[1]),e.$set(n)},i(l){t||(x(e.$$.fragment,l),t=!0)},o(l){ae(e.$$.fragment,l),t=!1},d(l){Ve(e,l)}}}function $l(s){let e,t,l='<h2 class="svelte-1frtfmv">User Role Assignments</h2>',a,n,r,u='<tr><th class="svelte-1frtfmv">User</th> <th class="svelte-1frtfmv">Email</th> <th class="svelte-1frtfmv">Roles</th> <th class="svelte-1frtfmv">Actions</th></tr>',c,v,f,m,g,C,k=be(s[0]),E=[];for(let b=0;b<k.length;b+=1)E[b]=Pt(Vt(s,k,b));const p=b=>ae(E[b],1,1,()=>{E[b]=null});let y=s[0].length===0&&Rt(),w=s[3]&&s[2]&&St(s);return{c(){e=h("div"),t=h("div"),t.innerHTML=l,a=z(),n=h("table"),r=h("thead"),r.innerHTML=u,c=z(),v=h("tbody");for(let b=0;b<E.length;b+=1)E[b].c();f=z(),y&&y.c(),m=z(),w&&w.c(),g=Ee(),this.h()},l(b){e=d(b,"DIV",{class:!0});var T=N(e);t=d(T,"DIV",{class:!0,"data-svelte-h":!0}),$(t)!=="svelte-u1tvaj"&&(t.innerHTML=l),a=A(T),n=d(T,"TABLE",{class:!0});var D=N(n);r=d(D,"THEAD",{"data-svelte-h":!0}),$(r)!=="svelte-4dg8hg"&&(r.innerHTML=u),c=A(D),v=d(D,"TBODY",{});var I=N(v);for(let V=0;V<E.length;V+=1)E[V].l(I);f=A(I),y&&y.l(I),I.forEach(_),D.forEach(_),T.forEach(_),m=A(b),w&&w.l(b),g=Ee(),this.h()},h(){i(t,"class","section-header svelte-1frtfmv"),i(n,"class","users-table svelte-1frtfmv"),i(e,"class","section svelte-1frtfmv")},m(b,T){M(b,e,T),o(e,t),o(e,a),o(e,n),o(n,r),o(n,c),o(n,v);for(let D=0;D<E.length;D+=1)E[D]&&E[D].m(v,null);o(v,f),y&&y.m(v,null),M(b,m,T),w&&w.m(b,T),M(b,g,T),C=!0},p(b,[T]){if(T&81){k=be(b[0]);let D;for(D=0;D<k.length;D+=1){const I=Vt(b,k,D);E[D]?(E[D].p(I,T),x(E[D],1)):(E[D]=Pt(I),E[D].c(),x(E[D],1),E[D].m(v,f))}for(je(),D=k.length;D<E.length;D+=1)p(D);Me()}b[0].length===0?y||(y=Rt(),y.c(),y.m(v,null)):y&&(y.d(1),y=null),b[3]&&b[2]?w?(w.p(b,T),T&12&&x(w,1)):(w=St(b),w.c(),x(w,1),w.m(g.parentNode,g)):w&&(je(),ae(w,1,1,()=>{w=null}),Me())},i(b){if(!C){for(let T=0;T<k.length;T+=1)x(E[T]);x(w),C=!0}},o(b){E=E.filter(Boolean);for(let T=0;T<E.length;T+=1)ae(E[T]);ae(w),C=!1},d(b){b&&(_(e),_(m),_(g)),qe(E,b),y&&y.d(),w&&w.d(b)}}}function ql(s,e,t){let{users:l=[]}=e,{roles:a=[]}=e;const n=$e();let r=null,u=!1;function c(C){t(2,r=C),t(3,u=!0)}async function v(C){const{userId:k,roleName:E}=C.detail;(await fetch(`/api/admin/iam/users/${k}/roles`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("auth_token")}`},body:JSON.stringify({role:E})})).ok?(n("rolesChanged",k),t(3,u=!1)):alert("Failed to assign role")}async function f(C){const{userId:k,roleName:E}=C.detail;if(!confirm(`Remove role ${E} from user?`))return;(await fetch(`/api/admin/iam/users/${k}/roles/${E}`,{method:"DELETE",headers:{Authorization:`Bearer ${localStorage.getItem("auth_token")}`}})).ok?n("rolesChanged",k):alert("Failed to remove role")}const m=C=>c(C),g=()=>t(3,u=!1);return s.$$set=C=>{"users"in C&&t(0,l=C.users),"roles"in C&&t(1,a=C.roles)},[l,a,r,u,c,v,f,m,g]}class Bl extends Ne{constructor(e){super(),Ae(this,e,ql,$l,ze,{users:0,roles:1})}}function $t(s,e,t){const l=s.slice();return l[9]=e[t],l}function qt(s,e,t){const l=s.slice();return l[12]=e[t],l}function Bt(s){let e;function t(n,r){return n[1].error?Ul:Ol}let l=t(s),a=l(s);return{c(){e=h("div"),a.c(),this.h()},l(n){e=d(n,"DIV",{class:!0});var r=N(e);a.l(r),r.forEach(_),this.h()},h(){i(e,"class","test-result svelte-1d3tzhv"),ve(e,"allowed",s[1].allowed),ve(e,"denied",!s[1].allowed&&!s[1].error)},m(n,r){M(n,e,r),a.m(e,null)},p(n,r){l===(l=t(n))&&a?a.p(n,r):(a.d(1),a=l(n),a&&(a.c(),a.m(e,null))),r&2&&ve(e,"allowed",n[1].allowed),r&2&&ve(e,"denied",!n[1].allowed&&!n[1].error)},d(n){n&&_(e),a.d()}}}function Ol(s){let e,t,l=s[1].allowed?"✓":"✗",a,n,r,u,c=s[1].allowed?"Allowed":"Denied",v,f,m,g,C=s[1].matchedPolicies&&s[1].matchedPolicies.length>0&&Ot(s),k=s[1].userRoles&&s[1].userRoles.length>0&&jt(s);return{c(){e=h("div"),t=h("span"),a=W(l),n=z(),r=h("span"),u=W("Permission "),v=W(c),f=z(),C&&C.c(),m=z(),k&&k.c(),g=Ee(),this.h()},l(E){e=d(E,"DIV",{class:!0});var p=N(e);t=d(p,"SPAN",{class:!0});var y=N(t);a=Q(y,l),y.forEach(_),n=A(p),r=d(p,"SPAN",{class:!0});var w=N(r);u=Q(w,"Permission "),v=Q(w,c),w.forEach(_),p.forEach(_),f=A(E),C&&C.l(E),m=A(E),k&&k.l(E),g=Ee(),this.h()},h(){i(t,"class","status-icon svelte-1d3tzhv"),i(r,"class","status-text"),i(e,"class","result-status svelte-1d3tzhv")},m(E,p){M(E,e,p),o(e,t),o(t,a),o(e,n),o(e,r),o(r,u),o(r,v),M(E,f,p),C&&C.m(E,p),M(E,m,p),k&&k.m(E,p),M(E,g,p)},p(E,p){p&2&&l!==(l=E[1].allowed?"✓":"✗")&&te(a,l),p&2&&c!==(c=E[1].allowed?"Allowed":"Denied")&&te(v,c),E[1].matchedPolicies&&E[1].matchedPolicies.length>0?C?C.p(E,p):(C=Ot(E),C.c(),C.m(m.parentNode,m)):C&&(C.d(1),C=null),E[1].userRoles&&E[1].userRoles.length>0?k?k.p(E,p):(k=jt(E),k.c(),k.m(g.parentNode,g)):k&&(k.d(1),k=null)},d(E){E&&(_(e),_(f),_(m),_(g)),C&&C.d(E),k&&k.d(E)}}}function Ul(s){let e,t,l="Error:",a,n=s[1].error+"",r;return{c(){e=h("div"),t=h("strong"),t.textContent=l,a=z(),r=W(n),this.h()},l(u){e=d(u,"DIV",{class:!0});var c=N(e);t=d(c,"STRONG",{"data-svelte-h":!0}),$(t)!=="svelte-1s1dywc"&&(t.textContent=l),a=A(c),r=Q(c,n),c.forEach(_),this.h()},h(){i(e,"class","result-error svelte-1d3tzhv")},m(u,c){M(u,e,c),o(e,t),o(e,a),o(e,r)},p(u,c){c&2&&n!==(n=u[1].error+"")&&te(r,n)},d(u){u&&_(e)}}}function Ot(s){let e,t,l="Matched Policies:",a,n,r=be(s[1].matchedPolicies),u=[];for(let c=0;c<r.length;c+=1)u[c]=Ut(qt(s,r,c));return{c(){e=h("div"),t=h("h4"),t.textContent=l,a=z(),n=h("ul");for(let c=0;c<u.length;c+=1)u[c].c();this.h()},l(c){e=d(c,"DIV",{class:!0});var v=N(e);t=d(v,"H4",{class:!0,"data-svelte-h":!0}),$(t)!=="svelte-1l7x6vu"&&(t.textContent=l),a=A(v),n=d(v,"UL",{class:!0});var f=N(n);for(let m=0;m<u.length;m+=1)u[m].l(f);f.forEach(_),v.forEach(_),this.h()},h(){i(t,"class","svelte-1d3tzhv"),i(n,"class","svelte-1d3tzhv"),i(e,"class","matched-policies svelte-1d3tzhv")},m(c,v){M(c,e,v),o(e,t),o(e,a),o(e,n);for(let f=0;f<u.length;f+=1)u[f]&&u[f].m(n,null)},p(c,v){if(v&2){r=be(c[1].matchedPolicies);let f;for(f=0;f<r.length;f+=1){const m=qt(c,r,f);u[f]?u[f].p(m,v):(u[f]=Ut(m),u[f].c(),u[f].m(n,null))}for(;f<u.length;f+=1)u[f].d(1);u.length=r.length}},d(c){c&&_(e),qe(u,c)}}}function Ut(s){let e,t=s[12]+"",l;return{c(){e=h("li"),l=W(t),this.h()},l(a){e=d(a,"LI",{class:!0});var n=N(e);l=Q(n,t),n.forEach(_),this.h()},h(){i(e,"class","svelte-1d3tzhv")},m(a,n){M(a,e,n),o(e,l)},p(a,n){n&2&&t!==(t=a[12]+"")&&te(l,t)},d(a){a&&_(e)}}}function jt(s){let e,t,l="User Roles:",a,n,r=be(s[1].userRoles),u=[];for(let c=0;c<r.length;c+=1)u[c]=Mt($t(s,r,c));return{c(){e=h("div"),t=h("h4"),t.textContent=l,a=z(),n=h("ul");for(let c=0;c<u.length;c+=1)u[c].c();this.h()},l(c){e=d(c,"DIV",{class:!0});var v=N(e);t=d(v,"H4",{class:!0,"data-svelte-h":!0}),$(t)!=="svelte-ex189a"&&(t.textContent=l),a=A(v),n=d(v,"UL",{class:!0});var f=N(n);for(let m=0;m<u.length;m+=1)u[m].l(f);f.forEach(_),v.forEach(_),this.h()},h(){i(t,"class","svelte-1d3tzhv"),i(n,"class","svelte-1d3tzhv"),i(e,"class","user-roles svelte-1d3tzhv")},m(c,v){M(c,e,v),o(e,t),o(e,a),o(e,n);for(let f=0;f<u.length;f+=1)u[f]&&u[f].m(n,null)},p(c,v){if(v&2){r=be(c[1].userRoles);let f;for(f=0;f<r.length;f+=1){const m=$t(c,r,f);u[f]?u[f].p(m,v):(u[f]=Mt(m),u[f].c(),u[f].m(n,null))}for(;f<u.length;f+=1)u[f].d(1);u.length=r.length}},d(c){c&&_(e),qe(u,c)}}}function Mt(s){let e,t=s[9]+"",l;return{c(){e=h("li"),l=W(t),this.h()},l(a){e=d(a,"LI",{class:!0});var n=N(e);l=Q(n,t),n.forEach(_),this.h()},h(){i(e,"class","svelte-1d3tzhv")},m(a,n){M(a,e,n),o(e,l)},p(a,n){n&2&&t!==(t=a[9]+"")&&te(l,t)},d(a){a&&_(e)}}}function jl(s){let e,t,l='<h2 class="svelte-1d3tzhv">Policy Tester</h2> <p class="section-subtitle svelte-1d3tzhv">Test permission checks with different inputs</p>',a,n,r,u,c,v="User ID",f,m,g,C,k,E="Resource",p,y,w,b,T,D="Action",I,V,L,P,R=s[2]?"Testing...":"Test Permission",B,O,F,J,j,H=s[1]&&Bt(s);return{c(){e=h("div"),t=h("div"),t.innerHTML=l,a=z(),n=h("div"),r=h("div"),u=h("div"),c=h("label"),c.textContent=v,f=z(),m=h("input"),g=z(),C=h("div"),k=h("label"),k.textContent=E,p=z(),y=h("input"),w=z(),b=h("div"),T=h("label"),T.textContent=D,I=z(),V=h("input"),L=z(),P=h("button"),B=W(R),F=z(),H&&H.c(),this.h()},l(S){e=d(S,"DIV",{class:!0});var q=N(e);t=d(q,"DIV",{class:!0,"data-svelte-h":!0}),$(t)!=="svelte-1lvf3cl"&&(t.innerHTML=l),a=A(q),n=d(q,"DIV",{class:!0});var ee=N(n);r=d(ee,"DIV",{class:!0});var ie=N(r);u=d(ie,"DIV",{class:!0});var G=N(u);c=d(G,"LABEL",{for:!0,class:!0,"data-svelte-h":!0}),$(c)!=="svelte-g5hl7m"&&(c.textContent=v),f=A(G),m=d(G,"INPUT",{id:!0,type:!0,placeholder:!0,class:!0}),G.forEach(_),g=A(ie),C=d(ie,"DIV",{class:!0});var oe=N(C);k=d(oe,"LABEL",{for:!0,class:!0,"data-svelte-h":!0}),$(k)!=="svelte-pst31f"&&(k.textContent=E),p=A(oe),y=d(oe,"INPUT",{id:!0,type:!0,placeholder:!0,class:!0}),oe.forEach(_),w=A(ie),b=d(ie,"DIV",{class:!0});var ne=N(b);T=d(ne,"LABEL",{for:!0,class:!0,"data-svelte-h":!0}),$(T)!=="svelte-g1233f"&&(T.textContent=D),I=A(ne),V=d(ne,"INPUT",{id:!0,type:!0,placeholder:!0,class:!0}),ne.forEach(_),ie.forEach(_),L=A(ee),P=d(ee,"BUTTON",{class:!0});var Z=N(P);B=Q(Z,R),Z.forEach(_),ee.forEach(_),F=A(q),H&&H.l(q),q.forEach(_),this.h()},h(){i(t,"class","section-header svelte-1d3tzhv"),i(c,"for","test-user"),i(c,"class","svelte-1d3tzhv"),i(m,"id","test-user"),i(m,"type","text"),i(m,"placeholder","user-123"),i(m,"class","svelte-1d3tzhv"),i(u,"class","form-group svelte-1d3tzhv"),i(k,"for","test-resource"),i(k,"class","svelte-1d3tzhv"),i(y,"id","test-resource"),i(y,"type","text"),i(y,"placeholder","/api/storage/files"),i(y,"class","svelte-1d3tzhv"),i(C,"class","form-group svelte-1d3tzhv"),i(T,"for","test-action"),i(T,"class","svelte-1d3tzhv"),i(V,"id","test-action"),i(V,"type","text"),i(V,"placeholder","read"),i(V,"class","svelte-1d3tzhv"),i(b,"class","form-group svelte-1d3tzhv"),i(r,"class","form-row svelte-1d3tzhv"),i(P,"class","btn btn-primary svelte-1d3tzhv"),P.disabled=O=s[2]||!s[0].userId||!s[0].resource||!s[0].action,i(n,"class","test-form svelte-1d3tzhv"),i(e,"class","section svelte-1d3tzhv")},m(S,q){M(S,e,q),o(e,t),o(e,a),o(e,n),o(n,r),o(r,u),o(u,c),o(u,f),o(u,m),Y(m,s[0].userId),o(r,g),o(r,C),o(C,k),o(C,p),o(C,y),Y(y,s[0].resource),o(r,w),o(r,b),o(b,T),o(b,I),o(b,V),Y(V,s[0].action),o(n,L),o(n,P),o(P,B),o(e,F),H&&H.m(e,null),J||(j=[U(m,"input",s[5]),U(m,"input",s[4]),U(y,"input",s[6]),U(y,"input",s[4]),U(V,"input",s[7]),U(V,"input",s[4]),U(P,"click",s[3])],J=!0)},p(S,[q]){q&1&&m.value!==S[0].userId&&Y(m,S[0].userId),q&1&&y.value!==S[0].resource&&Y(y,S[0].resource),q&1&&V.value!==S[0].action&&Y(V,S[0].action),q&4&&R!==(R=S[2]?"Testing...":"Test Permission")&&te(B,R),q&5&&O!==(O=S[2]||!S[0].userId||!S[0].resource||!S[0].action)&&(P.disabled=O),S[1]?H?H.p(S,q):(H=Bt(S),H.c(),H.m(e,null)):H&&(H.d(1),H=null)},i:le,o:le,d(S){S&&_(e),H&&H.d(),J=!1,He(j)}}}function Ml(s,e,t){$e();let l={userId:"",resource:"",action:""},a=null,n=!1;async function r(){t(2,n=!0);try{const m=await fetch("/api/admin/iam/test-permission",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("auth_token")}`},body:JSON.stringify(l)});t(1,a=await m.json())}catch(m){t(1,a={error:m.message})}finally{t(2,n=!1)}}function u(){t(1,a=null)}function c(){l.userId=this.value,t(0,l)}function v(){l.resource=this.value,t(0,l)}function f(){l.action=this.value,t(0,l)}return[l,a,n,r,u,c,v,f]}class Hl extends Ne{constructor(e){super(),Ae(this,e,Ml,jl,ze,{})}}function Ht(s){if(!s)return"";const e=new Date(s),l=new Date-e;if(l<6e4)return"just now";if(l<36e5){const a=Math.floor(l/6e4);return`${a} minute${a>1?"s":""} ago`}if(l<864e5){const a=Math.floor(l/36e5);return`${a} hour${a>1?"s":""} ago`}if(l<6048e5){const a=Math.floor(l/864e5);return`${a} day${a>1?"s":""} ago`}return e.toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"})}function Ft(s,e,t){const l=s.slice();return l[10]=e[t],l}function Jt(s,e,t){const l=s.slice();return l[13]=e[t],l}function Gt(s){let e,t=s[13].label+"",l;return{c(){e=h("option"),l=W(t),this.h()},l(a){e=d(a,"OPTION",{});var n=N(e);l=Q(n,t),n.forEach(_),this.h()},h(){e.__value=s[13].value,Y(e,e.__value)},m(a,n){M(a,e,n),o(e,l)},p:le,d(a){a&&_(e)}}}function Fl(s){let e,t=be(s[1]),l=[];for(let a=0;a<t.length;a+=1)l[a]=Kt(Ft(s,t,a));return{c(){e=h("div");for(let a=0;a<l.length;a+=1)l[a].c();this.h()},l(a){e=d(a,"DIV",{class:!0});var n=N(e);for(let r=0;r<l.length;r+=1)l[r].l(n);n.forEach(_),this.h()},h(){i(e,"class","logs-list svelte-15vmsyz")},m(a,n){M(a,e,n);for(let r=0;r<l.length;r+=1)l[r]&&l[r].m(e,null)},p(a,n){if(n&2){t=be(a[1]);let r;for(r=0;r<t.length;r+=1){const u=Ft(a,t,r);l[r]?l[r].p(u,n):(l[r]=Kt(u),l[r].c(),l[r].m(e,null))}for(;r<l.length;r+=1)l[r].d(1);l.length=t.length}},d(a){a&&_(e),qe(l,a)}}}function Jl(s){let e,t="No audit logs found";return{c(){e=h("div"),e.textContent=t,this.h()},l(l){e=d(l,"DIV",{class:!0,"data-svelte-h":!0}),$(e)!=="svelte-39amnf"&&(e.textContent=t),this.h()},h(){i(e,"class","empty svelte-15vmsyz")},m(l,a){M(l,e,a)},p:le,d(l){l&&_(e)}}}function Gl(s){let e,t="Loading audit logs...";return{c(){e=h("div"),e.textContent=t,this.h()},l(l){e=d(l,"DIV",{class:!0,"data-svelte-h":!0}),$(e)!=="svelte-8wnamb"&&(e.textContent=t),this.h()},h(){i(e,"class","loading svelte-15vmsyz")},m(l,a){M(l,e,a)},p:le,d(l){l&&_(e)}}}function Yt(s){let e,t,l="Resource:",a,n,r=s[10].resource+"",u;return{c(){e=h("div"),t=h("strong"),t.textContent=l,a=z(),n=h("code"),u=W(r),this.h()},l(c){e=d(c,"DIV",{class:!0});var v=N(e);t=d(v,"STRONG",{class:!0,"data-svelte-h":!0}),$(t)!=="svelte-2fh97g"&&(t.textContent=l),a=A(v),n=d(v,"CODE",{class:!0});var f=N(n);u=Q(f,r),f.forEach(_),v.forEach(_),this.h()},h(){i(t,"class","svelte-15vmsyz"),i(n,"class","svelte-15vmsyz"),i(e,"class","log-resource svelte-15vmsyz")},m(c,v){M(c,e,v),o(e,t),o(e,a),o(e,n),o(n,u)},p(c,v){v&2&&r!==(r=c[10].resource+"")&&te(u,r)},d(c){c&&_(e)}}}function Qt(s){let e,t,l="Action:",a,n,r=s[10].action+"",u;return{c(){e=h("div"),t=h("strong"),t.textContent=l,a=z(),n=h("code"),u=W(r),this.h()},l(c){e=d(c,"DIV",{class:!0});var v=N(e);t=d(v,"STRONG",{class:!0,"data-svelte-h":!0}),$(t)!=="svelte-1s2ciei"&&(t.textContent=l),a=A(v),n=d(v,"CODE",{class:!0});var f=N(n);u=Q(f,r),f.forEach(_),v.forEach(_),this.h()},h(){i(t,"class","svelte-15vmsyz"),i(n,"class","svelte-15vmsyz"),i(e,"class","log-action svelte-15vmsyz")},m(c,v){M(c,e,v),o(e,t),o(e,a),o(e,n),o(n,u)},p(c,v){v&2&&r!==(r=c[10].action+"")&&te(u,r)},d(c){c&&_(e)}}}function Wt(s){let e,t,l="Result:",a,n,r=s[10].result?"Allowed":"Denied",u;return{c(){e=h("div"),t=h("strong"),t.textContent=l,a=z(),n=h("span"),u=W(r),this.h()},l(c){e=d(c,"DIV",{class:!0});var v=N(e);t=d(v,"STRONG",{class:!0,"data-svelte-h":!0}),$(t)!=="svelte-fyf5wh"&&(t.textContent=l),a=A(v),n=d(v,"SPAN",{class:!0});var f=N(n);u=Q(f,r),f.forEach(_),v.forEach(_),this.h()},h(){i(t,"class","svelte-15vmsyz"),i(n,"class","result-badge svelte-15vmsyz"),ve(n,"allowed",s[10].result),ve(n,"denied",!s[10].result),i(e,"class","log-result svelte-15vmsyz")},m(c,v){M(c,e,v),o(e,t),o(e,a),o(e,n),o(n,u)},p(c,v){v&2&&r!==(r=c[10].result?"Allowed":"Denied")&&te(u,r),v&2&&ve(n,"allowed",c[10].result),v&2&&ve(n,"denied",!c[10].result)},d(c){c&&_(e)}}}function Xt(s){let e,t,l="Details:",a,n=JSON.stringify(s[10].metadata)+"",r;return{c(){e=h("div"),t=h("strong"),t.textContent=l,a=z(),r=W(n),this.h()},l(u){e=d(u,"DIV",{class:!0});var c=N(e);t=d(c,"STRONG",{class:!0,"data-svelte-h":!0}),$(t)!=="svelte-kd2azc"&&(t.textContent=l),a=A(c),r=Q(c,n),c.forEach(_),this.h()},h(){i(t,"class","svelte-15vmsyz"),i(e,"class","log-metadata svelte-15vmsyz")},m(u,c){M(u,e,c),o(e,t),o(e,a),o(e,r)},p(u,c){c&2&&n!==(n=JSON.stringify(u[10].metadata)+"")&&te(r,n)},d(u){u&&_(e)}}}function Kt(s){let e,t,l=Zt(s[10].type)+"",a,n,r,u,c,v=s[10].type.replace(/_/g," ")+"",f,m,g,C=Ht(s[10].timestamp)+"",k,E,p,y,w,b="User:",T,D=(s[10].user_id||"System")+"",I,V,L,P,R,B,O,F=s[10].resource&&Yt(s),J=s[10].action&&Qt(s),j=s[10].result!==void 0&&Wt(s),H=s[10].metadata&&Xt(s);return{c(){e=h("div"),t=h("div"),a=W(l),n=z(),r=h("div"),u=h("div"),c=h("span"),f=W(v),m=z(),g=h("span"),k=W(C),E=z(),p=h("div"),y=h("div"),w=h("strong"),w.textContent=b,T=z(),I=W(D),V=z(),F&&F.c(),L=z(),J&&J.c(),P=z(),j&&j.c(),R=z(),H&&H.c(),B=z(),this.h()},l(S){e=d(S,"DIV",{class:!0});var q=N(e);t=d(q,"DIV",{class:!0});var ee=N(t);a=Q(ee,l),ee.forEach(_),n=A(q),r=d(q,"DIV",{class:!0});var ie=N(r);u=d(ie,"DIV",{class:!0});var G=N(u);c=d(G,"SPAN",{class:!0});var oe=N(c);f=Q(oe,v),oe.forEach(_),m=A(G),g=d(G,"SPAN",{class:!0});var ne=N(g);k=Q(ne,C),ne.forEach(_),G.forEach(_),E=A(ie),p=d(ie,"DIV",{class:!0});var Z=N(p);y=d(Z,"DIV",{class:!0});var ge=N(y);w=d(ge,"STRONG",{class:!0,"data-svelte-h":!0}),$(w)!=="svelte-u80w43"&&(w.textContent=b),T=A(ge),I=Q(ge,D),ge.forEach(_),V=A(Z),F&&F.l(Z),L=A(Z),J&&J.l(Z),P=A(Z),j&&j.l(Z),R=A(Z),H&&H.l(Z),Z.forEach(_),ie.forEach(_),B=A(q),q.forEach(_),this.h()},h(){i(t,"class","log-icon svelte-15vmsyz"),i(c,"class","log-type svelte-15vmsyz"),i(g,"class","log-time svelte-15vmsyz"),i(u,"class","log-header svelte-15vmsyz"),i(w,"class","svelte-15vmsyz"),i(y,"class","log-user svelte-15vmsyz"),i(p,"class","log-details svelte-15vmsyz"),i(r,"class","log-content svelte-15vmsyz"),i(e,"class",O="log-entry "+xt(s[10].type)+" svelte-15vmsyz")},m(S,q){M(S,e,q),o(e,t),o(t,a),o(e,n),o(e,r),o(r,u),o(u,c),o(c,f),o(u,m),o(u,g),o(g,k),o(r,E),o(r,p),o(p,y),o(y,w),o(y,T),o(y,I),o(p,V),F&&F.m(p,null),o(p,L),J&&J.m(p,null),o(p,P),j&&j.m(p,null),o(p,R),H&&H.m(p,null),o(e,B)},p(S,q){q&2&&l!==(l=Zt(S[10].type)+"")&&te(a,l),q&2&&v!==(v=S[10].type.replace(/_/g," ")+"")&&te(f,v),q&2&&C!==(C=Ht(S[10].timestamp)+"")&&te(k,C),q&2&&D!==(D=(S[10].user_id||"System")+"")&&te(I,D),S[10].resource?F?F.p(S,q):(F=Yt(S),F.c(),F.m(p,L)):F&&(F.d(1),F=null),S[10].action?J?J.p(S,q):(J=Qt(S),J.c(),J.m(p,P)):J&&(J.d(1),J=null),S[10].result!==void 0?j?j.p(S,q):(j=Wt(S),j.c(),j.m(p,R)):j&&(j.d(1),j=null),S[10].metadata?H?H.p(S,q):(H=Xt(S),H.c(),H.m(p,null)):H&&(H.d(1),H=null),q&2&&O!==(O="log-entry "+xt(S[10].type)+" svelte-15vmsyz")&&i(e,"class",O)},d(S){S&&_(e),F&&F.d(),J&&J.d(),j&&j.d(),H&&H.d()}}}function Yl(s){let e,t,l,a='<h2 class="svelte-15vmsyz">Audit Log</h2> <p class="section-subtitle svelte-15vmsyz">Recent IAM activity and permission checks</p>',n,r,u=s[2]?"Refreshing...":"Refresh",c,v,f,m,g,C,k,E,p,y,w,b=be(s[4]),T=[];for(let L=0;L<b.length;L+=1)T[L]=Gt(Jt(s,b,L));function D(L,P){return L[2]?Gl:L[1].length===0?Jl:Fl}let I=D(s),V=I(s);return{c(){e=h("div"),t=h("div"),l=h("div"),l.innerHTML=a,n=z(),r=h("button"),c=W(u),v=z(),f=h("div"),m=h("div"),g=h("input"),C=z(),k=h("select");for(let L=0;L<T.length;L+=1)T[L].c();E=z(),p=h("div"),V.c(),this.h()},l(L){e=d(L,"DIV",{class:!0});var P=N(e);t=d(P,"DIV",{class:!0});var R=N(t);l=d(R,"DIV",{"data-svelte-h":!0}),$(l)!=="svelte-1ji7pjm"&&(l.innerHTML=a),n=A(R),r=d(R,"BUTTON",{class:!0});var B=N(r);c=Q(B,u),B.forEach(_),R.forEach(_),v=A(P),f=d(P,"DIV",{class:!0});var O=N(f);m=d(O,"DIV",{class:!0});var F=N(m);g=d(F,"INPUT",{type:!0,placeholder:!0,class:!0}),C=A(F),k=d(F,"SELECT",{class:!0});var J=N(k);for(let H=0;H<T.length;H+=1)T[H].l(J);J.forEach(_),F.forEach(_),O.forEach(_),E=A(P),p=d(P,"DIV",{class:!0});var j=N(p);V.l(j),j.forEach(_),P.forEach(_),this.h()},h(){i(r,"class","btn svelte-15vmsyz"),r.disabled=s[2],i(t,"class","section-header svelte-15vmsyz"),i(g,"type","text"),i(g,"placeholder","Filter logs..."),i(g,"class","svelte-15vmsyz"),i(k,"class","svelte-15vmsyz"),s[0]===void 0&&ct(()=>s[9].call(k)),i(m,"class","filter-group svelte-15vmsyz"),i(f,"class","controls svelte-15vmsyz"),i(p,"class","logs-container svelte-15vmsyz"),i(e,"class","section svelte-15vmsyz")},m(L,P){M(L,e,P),o(e,t),o(t,l),o(t,n),o(t,r),o(r,c),o(e,v),o(e,f),o(f,m),o(m,g),Y(g,s[3]),o(m,C),o(m,k);for(let R=0;R<T.length;R+=1)T[R]&&T[R].m(k,null);lt(k,s[0],!0),o(e,E),o(e,p),V.m(p,null),y||(w=[U(r,"click",s[5]),U(g,"input",s[7]),U(g,"keyup",s[8]),U(k,"change",s[9])],y=!0)},p(L,[P]){if(P&4&&u!==(u=L[2]?"Refreshing...":"Refresh")&&te(c,u),P&4&&(r.disabled=L[2]),P&8&&g.value!==L[3]&&Y(g,L[3]),P&16){b=be(L[4]);let R;for(R=0;R<b.length;R+=1){const B=Jt(L,b,R);T[R]?T[R].p(B,P):(T[R]=Gt(B),T[R].c(),T[R].m(k,null))}for(;R<T.length;R+=1)T[R].d(1);T.length=b.length}P&17&&lt(k,L[0]),I===(I=D(L))&&V?V.p(L,P):(V.d(1),V=I(L),V&&(V.c(),V.m(p,null)))},i:le,o:le,d(L){L&&_(e),qe(T,L),V.d(),y=!1,He(w)}}}function Zt(s){switch(s){case"permission_check":return"🔍";case"role_assigned":return"➕";case"role_removed":return"➖";case"policy_created":return"📝";case"policy_deleted":return"🗑️";default:return"📋"}}function xt(s){switch(s){case"permission_check":return"blue";case"role_assigned":return"green";case"role_removed":return"orange";case"policy_created":return"purple";case"policy_deleted":return"red";default:return"gray"}}function Ql(s,e,t){let{limit:l=50}=e,a=[],n=!1,r="",u="all";const c=[{value:"all",label:"All Events"},{value:"permission_check",label:"Permission Checks"},{value:"role_assigned",label:"Role Assignments"},{value:"role_removed",label:"Role Removals"},{value:"policy_created",label:"Policy Created"},{value:"policy_deleted",label:"Policy Deleted"}];async function v(){t(2,n=!0);try{const C=new URLSearchParams({limit:l.toString(),...r&&{filter:r},...u!=="all"&&{type:u}}),k=localStorage.getItem("auth_token");console.log("AuditLog: Using token:",k?`${k.substring(0,20)}...`:"null");const E=await window.fetch(`/api/admin/iam/audit-logs?${C}`,{method:"GET",headers:{Authorization:`Bearer ${k}`,"Content-Type":"application/json"},credentials:"same-origin"});if(console.log("AuditLog: Response status:",E.status),E.ok)t(1,a=await E.json()),console.log("AuditLog: Loaded",a.length,"logs");else{const p=await E.text();console.error("AuditLog: Error response:",E.status,p)}}catch(C){console.error("Failed to load audit logs:",C)}finally{t(2,n=!1)}}el(()=>{v()});function f(){r=this.value,t(3,r)}const m=C=>C.key==="Enter"&&v();function g(){u=ut(this),t(0,u),t(4,c)}return s.$$set=C=>{"limit"in C&&t(6,l=C.limit)},s.$$.update=()=>{s.$$.dirty&1&&u&&v()},[u,a,n,r,c,v,l,f,m,g]}class Wl extends Ne{constructor(e){super(),Ae(this,e,Ql,Yl,ze,{limit:6})}}function Xl(s){let e,t,l="Roles",a,n,r="Policies",u,c,v="User Assignments",f,m,g="Test Permissions",C,k,E="Audit Log",p,y,w,b,T,D,I;const V=[ls,ts,es,xl,Zl],L=[];function P(R,B){return R[0]==="roles"?0:R[0]==="policies"?1:R[0]==="users"?2:R[0]==="test"?3:R[0]==="audit"?4:-1}return~(w=P(s))&&(b=L[w]=V[w](s)),{c(){e=h("div"),t=h("button"),t.textContent=l,a=z(),n=h("button"),n.textContent=r,u=z(),c=h("button"),c.textContent=v,f=z(),m=h("button"),m.textContent=g,C=z(),k=h("button"),k.textContent=E,p=z(),y=h("div"),b&&b.c(),this.h()},l(R){e=d(R,"DIV",{class:!0});var B=N(e);t=d(B,"BUTTON",{class:!0,"data-svelte-h":!0}),$(t)!=="svelte-1iy7das"&&(t.textContent=l),a=A(B),n=d(B,"BUTTON",{class:!0,"data-svelte-h":!0}),$(n)!=="svelte-13nyibj"&&(n.textContent=r),u=A(B),c=d(B,"BUTTON",{class:!0,"data-svelte-h":!0}),$(c)!=="svelte-5s7y9m"&&(c.textContent=v),f=A(B),m=d(B,"BUTTON",{class:!0,"data-svelte-h":!0}),$(m)!=="svelte-x60ha9"&&(m.textContent=g),C=A(B),k=d(B,"BUTTON",{class:!0,"data-svelte-h":!0}),$(k)!=="svelte-1i3s0so"&&(k.textContent=E),B.forEach(_),p=A(R),y=d(R,"DIV",{class:!0});var O=N(y);b&&b.l(O),O.forEach(_),this.h()},h(){i(t,"class","tab svelte-1t6b2bm"),ve(t,"active",s[0]==="roles"),i(n,"class","tab svelte-1t6b2bm"),ve(n,"active",s[0]==="policies"),i(c,"class","tab svelte-1t6b2bm"),ve(c,"active",s[0]==="users"),i(m,"class","tab svelte-1t6b2bm"),ve(m,"active",s[0]==="test"),i(k,"class","tab svelte-1t6b2bm"),ve(k,"active",s[0]==="audit"),i(e,"class","tabs svelte-1t6b2bm"),i(y,"class","tab-content svelte-1t6b2bm")},m(R,B){M(R,e,B),o(e,t),o(e,a),o(e,n),o(e,u),o(e,c),o(e,f),o(e,m),o(e,C),o(e,k),M(R,p,B),M(R,y,B),~w&&L[w].m(y,null),T=!0,D||(I=[U(t,"click",s[12]),U(n,"click",s[13]),U(c,"click",s[14]),U(m,"click",s[15]),U(k,"click",s[16])],D=!0)},p(R,B){(!T||B&1)&&ve(t,"active",R[0]==="roles"),(!T||B&1)&&ve(n,"active",R[0]==="policies"),(!T||B&1)&&ve(c,"active",R[0]==="users"),(!T||B&1)&&ve(m,"active",R[0]==="test"),(!T||B&1)&&ve(k,"active",R[0]==="audit");let O=w;w=P(R),w===O?~w&&L[w].p(R,B):(b&&(je(),ae(L[O],1,1,()=>{L[O]=null}),Me()),~w?(b=L[w],b?b.p(R,B):(b=L[w]=V[w](R),b.c()),x(b,1),b.m(y,null)):b=null)},i(R){T||(x(b),T=!0)},o(R){ae(b),T=!1},d(R){R&&(_(e),_(p),_(y)),~w&&L[w].d(),D=!1,He(I)}}}function Kl(s){let e,t="Loading IAM configuration...";return{c(){e=h("div"),e.textContent=t,this.h()},l(l){e=d(l,"DIV",{class:!0,"data-svelte-h":!0}),$(e)!=="svelte-29zv1w"&&(e.textContent=t),this.h()},h(){i(e,"class","loading svelte-1t6b2bm")},m(l,a){M(l,e,a)},p:le,i:le,o:le,d(l){l&&_(e)}}}function Zl(s){let e,t;return e=new Wl({}),{c(){Se(e.$$.fragment)},l(l){Re(e.$$.fragment,l)},m(l,a){Pe(e,l,a),t=!0},p:le,i(l){t||(x(e.$$.fragment,l),t=!0)},o(l){ae(e.$$.fragment,l),t=!1},d(l){Ve(e,l)}}}function xl(s){let e,t;return e=new Hl({}),{c(){Se(e.$$.fragment)},l(l){Re(e.$$.fragment,l)},m(l,a){Pe(e,l,a),t=!0},p:le,i(l){t||(x(e.$$.fragment,l),t=!0)},o(l){ae(e.$$.fragment,l),t=!1},d(l){Ve(e,l)}}}function es(s){let e,t;return e=new Bl({props:{users:s[3],roles:s[1]}}),e.$on("rolesChanged",s[11]),{c(){Se(e.$$.fragment)},l(l){Re(e.$$.fragment,l)},m(l,a){Pe(e,l,a),t=!0},p(l,a){const n={};a&8&&(n.users=l[3]),a&2&&(n.roles=l[1]),e.$set(n)},i(l){t||(x(e.$$.fragment,l),t=!0)},o(l){ae(e.$$.fragment,l),t=!1},d(l){Ve(e,l)}}}function ts(s){let e,t;return e=new Dl({props:{policies:s[2]}}),e.$on("create",s[9]),e.$on("delete",s[10]),e.$on("policiesChanged",s[6]),{c(){Se(e.$$.fragment)},l(l){Re(e.$$.fragment,l)},m(l,a){Pe(e,l,a),t=!0},p(l,a){const n={};a&4&&(n.policies=l[2]),e.$set(n)},i(l){t||(x(e.$$.fragment,l),t=!0)},o(l){ae(e.$$.fragment,l),t=!1},d(l){Ve(e,l)}}}function ls(s){let e,t;return e=new _l({props:{roles:s[1]}}),e.$on("create",s[7]),e.$on("delete",s[8]),e.$on("rolesChanged",s[5]),{c(){Se(e.$$.fragment)},l(l){Re(e.$$.fragment,l)},m(l,a){Pe(e,l,a),t=!0},p(l,a){const n={};a&2&&(n.roles=l[1]),e.$set(n)},i(l){t||(x(e.$$.fragment,l),t=!0)},o(l){ae(e.$$.fragment,l),t=!1},d(l){Ve(e,l)}}}function ss(s){let e,t,l='<h1 class="svelte-1t6b2bm">Identity &amp; Access Management</h1> <p class="subtitle svelte-1t6b2bm">Manage roles, permissions, and access policies</p>',a,n,r,u;const c=[Kl,Xl],v=[];function f(m,g){return m[4]?0:1}return n=f(s),r=v[n]=c[n](s),{c(){e=h("div"),t=h("div"),t.innerHTML=l,a=z(),r.c(),this.h()},l(m){e=d(m,"DIV",{class:!0});var g=N(e);t=d(g,"DIV",{class:!0,"data-svelte-h":!0}),$(t)!=="svelte-i5bp06"&&(t.innerHTML=l),a=A(g),r.l(g),g.forEach(_),this.h()},h(){i(t,"class","page-header svelte-1t6b2bm"),i(e,"class","iam-container svelte-1t6b2bm")},m(m,g){M(m,e,g),o(e,t),o(e,a),v[n].m(e,null),u=!0},p(m,[g]){let C=n;n=f(m),n===C?v[n].p(m,g):(je(),ae(v[C],1,1,()=>{v[C]=null}),Me(),r=v[n],r?r.p(m,g):(r=v[n]=c[n](m),r.c()),x(r,1),r.m(e,null))},i(m){u||(x(r),u=!0)},o(m){ae(r),u=!1},d(m){m&&_(e),v[n].d()}}}function as(s,e,t){let l="roles",a=[],n=[],r=[],u=!0;async function c(){try{const I=await fetch("/api/admin/iam/roles",{headers:{Authorization:`Bearer ${localStorage.getItem("auth_token")}`}});I.ok?t(1,a=await I.json()):(console.error("Failed to load roles:",I.statusText),t(1,a=[]))}catch(I){console.error("Failed to load roles:",I),t(1,a=[])}}async function v(){try{const I=await fetch("/api/admin/iam/policies",{headers:{Authorization:`Bearer ${localStorage.getItem("auth_token")}`}});I.ok?t(2,n=await I.json()):(console.error("Failed to load policies:",I.statusText),t(2,n=[]))}catch(I){console.error("Failed to load policies:",I),t(2,n=[])}}async function f(){try{const I=await fetch("/api/admin/iam/users",{headers:{Authorization:`Bearer ${localStorage.getItem("auth_token")}`}});I.ok?t(3,r=await I.json()):(console.error("Failed to load users:",I.statusText),t(3,r=[]))}catch(I){console.error("Failed to load users:",I),t(3,r=[])}}async function m(){t(4,u=!0),await Promise.all([c(),v(),f()]),t(4,u=!1)}async function g(I){const V=I.detail;try{(await fetch("/api/admin/iam/roles",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("auth_token")}`},body:JSON.stringify(V)})).ok?await c():alert("Failed to create role")}catch(L){console.error("Failed to create role:",L),alert("Failed to create role")}}async function C(I){const V=I.detail;if(!confirm(`Delete role ${V.display_name||V.name}?`))return;(await fetch(`/api/admin/iam/roles/${V.name}`,{method:"DELETE",headers:{Authorization:`Bearer ${localStorage.getItem("auth_token")}`}})).ok?await c():alert("Failed to delete role")}async function k(I){const V=I.detail;(await fetch("/api/admin/iam/policies",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("auth_token")}`},body:JSON.stringify(V)})).ok?await v():alert("Failed to create policy")}async function E(I){const V=I.detail;if(!confirm(`Delete policy for ${V.subject}?`))return;(await fetch(`/api/admin/iam/policies/${V.id}`,{method:"DELETE",headers:{Authorization:`Bearer ${localStorage.getItem("auth_token")}`}})).ok?await v():alert("Failed to delete policy")}async function p(){await f()}return el(()=>{m()}),[l,a,n,r,u,c,v,g,C,k,E,p,()=>t(0,l="roles"),()=>t(0,l="policies"),()=>t(0,l="users"),()=>t(0,l="test"),()=>t(0,l="audit")]}class is extends Ne{constructor(e){super(),Ae(this,e,as,ss,ze,{})}}export{is as component};
