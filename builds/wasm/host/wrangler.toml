# Solobase WASM - Cloudflare Workers Configuration
#
# Local development:
#   make dev-wasm     # Builds WASM and runs wrangler dev
#
# Deploy to Cloudflare:
#   1. Create D1 database: npx wrangler d1 create solobase
#   2. Update database_id below with the returned ID
#   3. Run: make deploy-wasm

name = "solobase"
main = "src/index.ts"
compatibility_date = "2024-01-01"

# Static assets (frontend)
[assets]
directory = "./static"
not_found_handling = "single-page-application"  # Serve index.html for SPA routes

[vars]
JWT_SECRET = "dev-secret-key-minimum-32-characters-long"
DEFAULT_ADMIN_EMAIL = "admin@example.com"
DEFAULT_ADMIN_PASSWORD = "admin123"

# D1 SQLite Database
# For local dev: wrangler creates a local SQLite automatically
# For production: create with `npx wrangler d1 create solobase` and update ID
[[d1_databases]]
binding = "DB"
database_name = "solobase"
database_id = "local"
migrations_dir = "./migrations"

# R2 Storage (optional - uncomment to enable)
# [[r2_buckets]]
# binding = "STORAGE"
# bucket_name = "solobase-files"

# Local development settings
[dev]
port = 8787
local_protocol = "http"

# WASM loading
[[rules]]
type = "CompiledWasm"
globs = ["**/*.wasm"]
